<!DOCTYPE html>
<!-- saved from url=(0048) -->
<html class="gr__steeltoe_io">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">

	<meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

	<!-- Use title if it's in the page YAML frontmatter -->
	<link href="images/favicon.png" rel="icon" type="image/png">
	<link rel="stylesheet" href="/stylesheets/css.css">
	<link href="/stylesheets/site.css" rel="stylesheet">
	<link href="/stylesheets/tocbot.css" rel="stylesheet">
</head>

<body class="docs docs_steeltoe-connectors docs_steeltoe-connectors_index" data-gr-c-s-loaded="true">
	<div class="max-width-4 mx-auto">
		<div class="">
			<div class="sm-flex">
				<div class="col-12 sm-col-3 sm-pr3">
					
					<div id="toc" class="">
						<div class="toc-link border-bottom border-silver js-toc"><ul class="toc-list "><li class="toc-list-item"><a href="#0-0-initialize-dev-environment" class="toc-link node-name--H1  is-active-link">0.0 Initialize Dev Environment</a></li><li class="toc-list-item"><a href="#1-0-mysql" class="toc-link node-name--H1 ">1.0 MySQL</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#1-1-quick-start" class="toc-link node-name--H2 ">1.1 Quick Start</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#1-1-1-locate-sample" class="toc-link node-name--H3 ">1.1.1 Locate Sample</a></li><li class="toc-list-item"><a href="#1-1-2-create-service" class="toc-link node-name--H3 ">1.1.2 Create Service</a></li><li class="toc-list-item"><a href="#1-1-3-publish-and-push-the-sample" class="toc-link node-name--H3 ">1.1.3 Publish and Push the Sample</a></li><li class="toc-list-item"><a href="#1-1-4-observe-logs" class="toc-link node-name--H3 ">1.1.4 Observe Logs</a></li><li class="toc-list-item"><a href="#1-1-5-view-data" class="toc-link node-name--H3 ">1.1.5 View Data</a></li><li class="toc-list-item"><a href="#1-1-6-understand-the-sample" class="toc-link node-name--H3 ">1.1.6 Understand the Sample</a></li></ul></li><li class="toc-list-item"><a href="#1-2-usage" class="toc-link node-name--H2 ">1.2 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#1-2-1-add-nuget-reference" class="toc-link node-name--H3 ">1.2.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#1-2-2-configure-settings" class="toc-link node-name--H3 ">1.2.2 Configure Settings</a></li><li class="toc-list-item"><a href="#1-2-3-cloud-foundry" class="toc-link node-name--H3 ">1.2.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#1-2-4-add-mysqlconnection" class="toc-link node-name--H3 ">1.2.4 Add MySqlConnection</a></li><li class="toc-list-item"><a href="#1-2-5-use-mysqlconnection" class="toc-link node-name--H3 ">1.2.5 Use MySqlConnection</a></li><li class="toc-list-item"><a href="#1-2-6-add-dbcontext" class="toc-link node-name--H3 ">1.2.6 Add DbContext</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#1-2-6-1-entity-framework-6" class="toc-link node-name--H4 ">1.2.6.1 Entity Framework 6</a></li><li class="toc-list-item"><a href="#1-2-6-2-entity-framework-core" class="toc-link node-name--H4 ">1.2.6.2 Entity Framework Core</a></li></ul></li><li class="toc-list-item"><a href="#1-2-7-use-dbcontext" class="toc-link node-name--H3 ">1.2.7 Use DbContext</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#2-0-postgresql" class="toc-link node-name--H1 ">2.0 PostgreSQL</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#2-1-quick-start" class="toc-link node-name--H2 ">2.1 Quick Start</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#2-1-1-locate-sample" class="toc-link node-name--H3 ">2.1.1 Locate Sample</a></li><li class="toc-list-item"><a href="#2-1-2-create-service" class="toc-link node-name--H3 ">2.1.2 Create Service</a></li><li class="toc-list-item"><a href="#2-1-3-publish-and-push-sample" class="toc-link node-name--H3 ">2.1.3 Publish and Push Sample</a></li><li class="toc-list-item"><a href="#2-1-4-observe-logs" class="toc-link node-name--H3 ">2.1.4 Observe Logs</a></li><li class="toc-list-item"><a href="#2-1-4-what-to-expect" class="toc-link node-name--H3 ">2.1.4 What to expect</a></li><li class="toc-list-item"><a href="#2-1-5-understand-sample" class="toc-link node-name--H3 ">2.1.5 Understand Sample</a></li></ul></li><li class="toc-list-item"><a href="#2-2-usage" class="toc-link node-name--H2 ">2.2 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#2-2-1-add-nuget-reference" class="toc-link node-name--H3 ">2.2.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#2-2-2-configure-settings" class="toc-link node-name--H3 ">2.2.2 Configure Settings</a></li><li class="toc-list-item"><a href="#2-2-3-cloud-foundry" class="toc-link node-name--H3 ">2.2.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#2-2-4-add-npgsqlconnection" class="toc-link node-name--H3 ">2.2.4 Add NpgsqlConnection</a></li><li class="toc-list-item"><a href="#2-2-5-use-npgsqlconnection" class="toc-link node-name--H3 ">2.2.5 Use NpgsqlConnection</a></li><li class="toc-list-item"><a href="#2-2-6-add-dbcontext" class="toc-link node-name--H3 ">2.2.6 Add DbContext</a></li><li class="toc-list-item"><a href="#2-2-7-use-dbcontext" class="toc-link node-name--H3 ">2.2.7 Use DbContext</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#3-0-microsoft-sql-server" class="toc-link node-name--H1 ">3.0 Microsoft SQL Server</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#3-1-quick-start" class="toc-link node-name--H2 ">3.1 Quick Start</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#3-1-1-locate-sample" class="toc-link node-name--H3 ">3.1.1 Locate Sample</a></li><li class="toc-list-item"><a href="#3-1-2-create-service" class="toc-link node-name--H3 ">3.1.2 Create Service</a></li><li class="toc-list-item"><a href="#3-1-3-publish-and-push-sample" class="toc-link node-name--H3 ">3.1.3 Publish and Push Sample</a></li><li class="toc-list-item"><a href="#3-1-4-observe-logs" class="toc-link node-name--H3 ">3.1.4 Observe Logs</a></li><li class="toc-list-item"><a href="#3-1-5-view-data" class="toc-link node-name--H3 ">3.1.5 View Data</a></li><li class="toc-list-item"><a href="#3-1-6-understand-samples" class="toc-link node-name--H3 ">3.1.6 Understand Samples</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#3-1-6-1-asp-net-core-sample" class="toc-link node-name--H4 ">3.1.6.1 ASP.NET Core Sample</a></li><li class="toc-list-item"><a href="#3-1-6-2-asp-net-4-x-sample" class="toc-link node-name--H4 ">3.1.6.2 ASP.NET 4.x Sample</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#3-2-usage" class="toc-link node-name--H2 ">3.2 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#3-2-1-add-nuget-reference" class="toc-link node-name--H3 ">3.2.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#3-2-2-configure-settings" class="toc-link node-name--H3 ">3.2.2 Configure Settings</a></li><li class="toc-list-item"><a href="#3-2-3-cloud-foundry" class="toc-link node-name--H3 ">3.2.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#3-2-4-add-sqlconnection" class="toc-link node-name--H3 ">3.2.4 Add SqlConnection</a></li><li class="toc-list-item"><a href="#3-2-5-use-sqlconnection" class="toc-link node-name--H3 ">3.2.5 Use SqlConnection</a></li><li class="toc-list-item"><a href="#3-2-6-add-dbcontext" class="toc-link node-name--H3 ">3.2.6 Add DbContext</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#3-2-6-1-entity-framework-6" class="toc-link node-name--H4 ">3.2.6.1 Entity Framework 6</a></li><li class="toc-list-item"><a href="#3-2-6-2-entity-framework-core" class="toc-link node-name--H4 ">3.2.6.2 Entity Framework Core</a></li></ul></li><li class="toc-list-item"><a href="#3-2-7-use-dbcontext" class="toc-link node-name--H3 ">3.2.7 Use DbContext</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#4-0-rabbitmq" class="toc-link node-name--H1 ">4.0 RabbitMQ</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#4-1-quick-start" class="toc-link node-name--H2 ">4.1 Quick Start</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#4-1-1-locate-sample" class="toc-link node-name--H3 ">4.1.1 Locate Sample</a></li><li class="toc-list-item"><a href="#4-1-2-create-service" class="toc-link node-name--H3 ">4.1.2 Create Service</a></li><li class="toc-list-item"><a href="#4-1-3-publish-and-push-sample" class="toc-link node-name--H3 ">4.1.3 Publish and Push Sample</a></li><li class="toc-list-item"><a href="#4-1-4-observe-logs" class="toc-link node-name--H3 ">4.1.4 Observe Logs</a></li><li class="toc-list-item"><a href="#4-1-5-view-data" class="toc-link node-name--H3 ">4.1.5 View Data</a></li><li class="toc-list-item"><a href="#4-1-6-understand-the-sample" class="toc-link node-name--H3 ">4.1.6 Understand the Sample</a></li></ul></li><li class="toc-list-item"><a href="#4-2-usage" class="toc-link node-name--H2 ">4.2 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#4-2-1-add-nuget-reference" class="toc-link node-name--H3 ">4.2.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#4-2-2-configure-settings" class="toc-link node-name--H3 ">4.2.2 Configure Settings</a></li><li class="toc-list-item"><a href="#4-2-3-cloud-foundry" class="toc-link node-name--H3 ">4.2.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#4-2-4-add-rabbitmq-connectionfactory" class="toc-link node-name--H3 ">4.2.4 Add RabbitMQ ConnectionFactory</a></li><li class="toc-list-item"><a href="#4-2-5-use-rabbitmq-connectionfactory" class="toc-link node-name--H3 ">4.2.5 Use RabbitMQ ConnectionFactory</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#5-0-redis" class="toc-link node-name--H1 ">5.0 Redis</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#5-1-quick-start" class="toc-link node-name--H2 ">5.1 Quick Start</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#5-1-1-locate-sample" class="toc-link node-name--H3 ">5.1.1 Locate Sample</a></li><li class="toc-list-item"><a href="#5-1-2-create-service" class="toc-link node-name--H3 ">5.1.2 Create Service</a></li><li class="toc-list-item"><a href="#5-1-3-publish-and-push-sample" class="toc-link node-name--H3 ">5.1.3 Publish and Push Sample</a></li><li class="toc-list-item"><a href="#5-1-4-observe-logs" class="toc-link node-name--H3 ">5.1.4 Observe Logs</a></li><li class="toc-list-item"><a href="#5-1-5-what-to-expect" class="toc-link node-name--H3 ">5.1.5 What to expect</a></li><li class="toc-list-item"><a href="#5-1-6-understand-sample" class="toc-link node-name--H3 ">5.1.6 Understand Sample</a></li></ul></li><li class="toc-list-item"><a href="#5-2-usage" class="toc-link node-name--H2 ">5.2 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#5-2-1-add-nuget-reference" class="toc-link node-name--H3 ">5.2.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#5-2-2-configure-settings" class="toc-link node-name--H3 ">5.2.2 Configure Settings</a></li><li class="toc-list-item"><a href="#5-2-3-cloud-foundry" class="toc-link node-name--H3 ">5.2.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#5-2-4-add-idistributedcache" class="toc-link node-name--H3 ">5.2.4 Add IDistributedCache</a></li><li class="toc-list-item"><a href="#5-2-5-use-idistributedcache" class="toc-link node-name--H3 ">5.2.5 Use IDistributedCache</a></li><li class="toc-list-item"><a href="#5-2-6-add-iconnectionmultiplexer" class="toc-link node-name--H3 ">5.2.6 Add IConnectionMultiplexer</a></li><li class="toc-list-item"><a href="#5-2-7-use-iconnectionmultiplexer" class="toc-link node-name--H3 ">5.2.7 Use IConnectionMultiplexer</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#6-0-oauth" class="toc-link node-name--H1 ">6.0 OAuth</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#6-1-quick-start" class="toc-link node-name--H2 ">6.1 Quick Start</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#6-1-1-locate-sample" class="toc-link node-name--H3 ">6.1.1 Locate Sample</a></li><li class="toc-list-item"><a href="#6-1-2-create-service" class="toc-link node-name--H3 ">6.1.2 Create Service</a></li><li class="toc-list-item"><a href="#6-1-3-publish-and-push-sample" class="toc-link node-name--H3 ">6.1.3 Publish and Push Sample</a></li><li class="toc-list-item"><a href="#6-1-4-observe-logs" class="toc-link node-name--H3 ">6.1.4 Observe Logs</a></li><li class="toc-list-item"><a href="#6-1-5-view-data" class="toc-link node-name--H3 ">6.1.5 View Data</a></li><li class="toc-list-item"><a href="#6-1-6-understand-sample" class="toc-link node-name--H3 ">6.1.6 Understand Sample</a></li></ul></li><li class="toc-list-item"><a href="#6-2-usage" class="toc-link node-name--H2 ">6.2 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#6-2-1-add-nuget-reference" class="toc-link node-name--H3 ">6.2.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#6-2-2-configure-settings" class="toc-link node-name--H3 ">6.2.2 Configure Settings</a></li><li class="toc-list-item"><a href="#6-2-3-cloud-foundry" class="toc-link node-name--H3 ">6.2.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#6-2-4-add-oauthserviceoptions" class="toc-link node-name--H3 ">6.2.4 Add OAuthServiceOptions</a></li><li class="toc-list-item"><a href="#6-2-5-use-oauthserviceoptions" class="toc-link node-name--H3 ">6.2.5 Use OAuthServiceOptions</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#7-0-mongodb" class="toc-link node-name--H1 ">7.0 MongoDB</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#7-1-usage" class="toc-link node-name--H2 ">7.1 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#7-1-1-add-nuget-reference" class="toc-link node-name--H3 ">7.1.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#7-1-2-configure-settings" class="toc-link node-name--H3 ">7.1.2 Configure Settings</a></li><li class="toc-list-item"><a href="#7-1-3-cloud-foundry" class="toc-link node-name--H3 ">7.1.3 Cloud Foundry</a></li><li class="toc-list-item"><a href="#7-1-4-add-mongo-client" class="toc-link node-name--H3 ">7.1.4 Add Mongo Client</a></li><li class="toc-list-item"><a href="#7-1-4-use-mongo-client" class="toc-link node-name--H3 ">7.1.4 Use Mongo Client</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#8-0-apache-geode-gemfire-pivotal-cloud-cache" class="toc-link node-name--H1 ">8.0 Apache Geode/GemFire/Pivotal Cloud Cache</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#8-1-usage" class="toc-link node-name--H2 ">8.1 Usage</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#8-1-0-get-gemfire-driver" class="toc-link node-name--H3 ">8.1.0 Get GemFire Driver</a></li><li class="toc-list-item"><a href="#8-1-1-add-nuget-reference" class="toc-link node-name--H3 ">8.1.1 Add NuGet Reference</a></li><li class="toc-list-item"><a href="#8-1-2-configure-settings" class="toc-link node-name--H3 ">8.1.2 Configure Settings</a></li><li class="toc-list-item"><a href="#8-1-3-cloud-foundry" class="toc-link node-name--H3 ">8.1.3 Cloud Foundry</a></li></ul></li></ul></li><li class="toc-list-item"><a href="#common-steps" class="toc-link node-name--H1 ">Common Steps</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#publish-sample" class="toc-link node-name--H2 ">Publish Sample</a><ul class="toc-list  is-collapsible is-collapsed"><li class="toc-list-item"><a href="#asp-net-core" class="toc-link node-name--H3 ">ASP.NET Core</a></li><li class="toc-list-item"><a href="#asp-net-4-x" class="toc-link node-name--H3 ">ASP.NET 4.x</a></li></ul></li><li class="toc-list-item"><a href="#push-sample" class="toc-link node-name--H2 ">Push Sample</a></li><li class="toc-list-item"><a href="#observe-logs" class="toc-link node-name--H2 ">Observe Logs</a></li><li class="toc-list-item"><a href="#reading-configuration-values" class="toc-link node-name--H2 ">Reading Configuration Values</a></li><li class="toc-list-item"><a href="#add-nuget-references" class="toc-link node-name--H2 ">Add NuGet References</a></li><li class="toc-list-item"><a href="#using-health-contributors" class="toc-link node-name--H2 ">Using Health Contributors</a></li><li class="toc-list-item"><a href="#using-asp-net-core-health-checks" class="toc-link node-name--H2 ">Using ASP.NET Core Health Checks</a></li></ul></li></ul></div>
					</div>
				</div>
				<div class="col-12 sm-col-9 js-toc-content">

					<h1 id="1-0-mysql">1.0 MySQL</h1>

					<p>This connector simplifies using MySQL ADO.NET providers in an application running on Cloud Foundry.</p>

					<p>Currently, the connector supports the following providers:</p>

					<ul>
						<li><a target="_blank" href="https://dev.mysql.com/doc/connector-net/en/">Connector/NET</a></li>
						<li><a target="_blank" href="https://mysql-net.github.io/MySqlConnector/">MySqlConnector</a></li>
					</ul>

					<p>You should know how the new .NET <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Configuration service</a> works before starting to use the connector. A basic understanding of the <code>ConfigurationBuilder</code> and how to add providers to the builder is necessary in order to configure the connector.</p>

					<p>You should also know how the ASP.NET Core <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup">Startup</a> class is used in configuring the application services for the app. Pay particular attention to the usage of the <code>ConfigureServices()</code> method.</p>

					<p>To use this connector:</p>

					<ol>
						<li>Create a MySQL Service instance and bind it to your application.</li>
						<li>Optionally, configure any MySQL client settings (such as <code>appsettings.json</code>) you need.</li>
						<li>Add the Steeltoe Cloud Foundry configuration provider to your <code>ConfigurationBuilder</code>.</li>
						<li>Add <code>MySqlConnection</code> or <code>DbContext</code> to your <code>IServiceCollection</code>.</li>
					</ol>

					<h3 id="1-2-1-add-nuget-reference">1.2.1 Add NuGet Reference</h3>

					<p>To use the MySQL connector, add your choice of MySQL-specific package(s) between <a target="_blank" href="https://www.nuget.org/packages/MySql.Data">MySql.Data</a>/<a target="_blank" href="https://www.nuget.org/packages/MySql.Data.Entity">MySql.Data.Entity</a>, <a target="_blank" href="https://www.nuget.org/packages/MySqlConnector/">MySqlConnector</a>, and <a target="_blank" href="https://www.nuget.org/packages/Pomelo.EntityFrameworkCore.MySql/">Pomelo.EntityFrameworkCore.MySql</a> as you would if you weren’t using Steeltoe. Then, add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a>.</p>

					<h3 id="1-2-2-configure-settings">1.2.2 Configure Settings</h3>

					<p>The connector supports a variety of configuration options. You can use these settings to develop or test an application locally and override them during deployment.</p>

					<p>The following MySQL connector configuration shows how to connect to a database at <code>myserver:3306</code>:</p>

<pre><code class="json hljs">{
  ...
					<span class="hljs-attr">"mysql"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"server"</span>: <span class="hljs-string">"myserver"</span>,
					<span class="hljs-attr">"port"</span>: <span class="hljs-number">3306</span>
    }
  }
  ...
}
</code></pre>

					<p>The following table describes the available settings for the connector. These settings are not specific to Steeltoe. They are passed through to the underlying data provider. See the <a target="_blank" href="https://dev.mysql.com/doc/connector-net/en/connector-net-connection-options.html">Oracle MySQL Connection String docs</a> or <a target="_blank" href="https://mysql-net.github.io/MySqlConnector/connection-options/">open source MySQL Connection String docs</a>.</p>

					<table>
						<thead>
							<tr>
								<th>Key</th>
								<th>Description</th>
								<th style="text-align: center">Steeltoe Default</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>server</td>
								<td>Hostname or IP Address of the server</td>
								<td style="text-align: center">localhost</td>
							</tr>
							<tr>
								<td>port</td>
								<td>Port number of server</td>
								<td style="text-align: center">3306</td>
							</tr>
							<tr>
								<td>username</td>
								<td>Username for authentication</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>password</td>
								<td>Password for authentication</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>database</td>
								<td>Schema to which to connect</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>connectionString</td>
								<td>Full connection string</td>
								<td style="text-align: center">built from settings</td>
							</tr>
							<tr>
								<td>sslMode</td>
								<td>SSL usage option. One of <code>None</code>, <code>Preferred</code>, or <code>Required</code></td>
								<td style="text-align: center"><code>None</code></td>
							</tr>
							<tr>
								<td>allowPublicKeyRetrieval</td>
								<td>Whether RSA public keys should be retrieved from the server</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>allowUserVariables</td>
								<td>Whether the provider expects user variables in the SQL</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>connectionTimeout</td>
								<td>Seconds to wait for a connection before throwing an error</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>connectionLifeTime</td>
								<td>The maximum length of time a connection to the server can be open</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>connectionReset</td>
								<td>Whether the connection state is reset when it is retrieved from the pool</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>convertZeroDateTime</td>
								<td>Whether to have MySqlDataReader.GetValue() and MySqlDataReader.GetDateTime() return DateTime.MinValue for date or datetime columns that have disallowed values</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>defaultCommandTimeout</td>
								<td>Seconds each command can execute before timing out. Use 0 to disable timeouts</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>keepalive</td>
								<td>TCP keep-alive idle time</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>maximumPoolsize</td>
								<td>Maximum number of connections allowed in the pool</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>minimumPoolsize</td>
								<td>Minimum number of connections to leave in the pool if ConnectionIdleTimeout is reached</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>oldGuids</td>
								<td>Whether to use a GUID of data type BINARY(16)</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>persistSecurityInfo</td>
								<td>Whether to allow the application to access to security-sensitive information, such as the password. <strong><em>(Not recommended)</em></strong></td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>pooling</td>
								<td>Enables connection pooling</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>treatTinyAsBoolean</td>
								<td>Whether to return tinyint(1) as a boolean. Set to <code>false</code> to return tinyint(1) as sbyte/byte</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>useAffectedRows</td>
								<td>Set to <code>false</code> to report found rows instead of changed (affected) rows</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>useCompression</td>
								<td>If <code>true</code> (and server-supported), packets sent between client and server are compressed</td>
								<td style="text-align: center">not set</td>
							</tr>
							<tr>
								<td>urlEncodedCredentials</td>
								<td>Set to <code>true</code> if your service broker provides URL-encoded credentials</td>
								<td style="text-align: center">false</td>
							</tr>
						</tbody>
					</table>

					<blockquote>
						<p>IMPORTANT: All of the settings described in the preceding table should be prefixed with <code>mysql:client:</code>.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<blockquote>
						<p>NOTE: If a ConnectionString is provided and VCAP_SERVICES are not detected (a typical scenario for local app development), the ConnectionString will be used exactly as provided.</p>
					</blockquote>

					<h3 id="1-2-3-cloud-foundry">1.2.3 Cloud Foundry</h3>

					<p>To use MySQL on Cloud Foundry, you can create and bind an instance of MySQL to your application by using the Cloud Foundry CLI, as follows:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Create MySQL service</span>
cf create-service p-mysql 100mb myMySqlService

<span class="hljs-comment"># Bind service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp myMySqlService

<span class="hljs-comment"># Restage the app to pick up change</span>
cf restage myApp
</code></pre>

					<blockquote>
						<p>NOTE: The preceding commands assume you use <a target="_blank" href="https://network.pivotal.io/products/p-mysql">MySQL for PCF</a>, provided by Pivotal on Cloud Foundry. If you use a different service, you must adjust the <code>create-service</code> command to fit your environment.</p>
					</blockquote>

					<p>Version 2.1.1+ of this connector works with the <a target="_blank" href="https://docs.pivotal.io/partners/azure-open-service-broker-pcf/index.html">Azure Open Service Broker for PCF</a>. Be sure to set <code>mysql:client:urlEncodedCredentials</code> to <code>true</code> as this broker may provide credentials that have been URL Encoded.</p>

					<p>Once the service is bound to your application, the connector’s settings are available in <code>VCAP_SERVICES</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="1-2-4-add-mysqlconnection">1.2.4 Add MySqlConnection</h3>

					<p>To use a <code>MySqlConnection</code> in your application, add it to the service container in the <code>ConfigureServices()</code> method of the <code>Startup</code> class, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.MySql;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
					<span class="hljs-comment">// Add MySqlConnection configured from Configuration</span>
        services.AddMySqlConnection(Configuration);

					<span class="hljs-comment">// Add framework services.</span>
        services.AddMvc();
        ...
    }
    ...
</code></pre>

					<p>The <code>AddMySqlConnection(Configuration)</code> method call configures the <code>MySqlConnection</code> by using the configuration built by the application and adds the connection to the service container.</p>

					<h3 id="1-2-5-use-mysqlconnection">1.2.5 Use MySqlConnection</h3>

					<p>Once you have configured and added the connection to the service container, it is trivial to inject and use in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> MySql.Data.MySqlClient;
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">MySqlData</span>(<span class="hljs-params">[FromServices] MySqlConnection dbConnection</span>)
    </span>{
        dbConnection.Open();

        MySqlCommand cmd = <span class="hljs-keyword">new</span> MySqlCommand(<span class="hljs-string">"SELECT * FROM TestData;"</span>, dbConnection);
        MySqlDataReader rdr = cmd.ExecuteReader();

					<span class="hljs-keyword">while</span> (rdr.Read())
        {
            ViewData[<span class="hljs-string">"Key"</span> + rdr[<span class="hljs-number">0</span>]] = rdr[<span class="hljs-number">1</span>];
        }

        rdr.Close();
        dbConnection.Close();

					<span class="hljs-keyword">return</span> View();
    }
}
</code></pre>

					<h3 id="1-2-6-add-dbcontext">1.2.6 Add DbContext</h3>

					<h4 id="1-2-6-1-entity-framework-6">1.2.6.1 Entity Framework 6</h4>

					<p>To use the MySQL connector with Entity Framework 6, inject a <code>DbContext</code> into your application using the <code>AddDbContext&lt;&gt;()</code> method (provided by Steeltoe) that takes an <code>IConfiguration</code> as a parameter, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.MySql.EF6;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
        ...
        services.AddDbContext&lt;TestContext&gt;(Configuration);
        ...
    }
    ...
</code></pre>

					<p>The <code>AddDbContext&lt;TestContext&gt;(..)</code> method call configures <code>TestContext</code> using the configuration built earlier and then adds the DbContext (called <code>TestContext</code>) to the service container.</p>

					<p>Your <code>DbContext</code> does not need to be modified from a standard EF6 <code>DbContext</code> to work with Steeltoe:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> MySql.Data.Entity;
<span class="hljs-keyword">using</span> System.Data.Entity;
...

[DbConfigurationType(<span class="hljs-keyword">typeof</span>(MySqlEFConfiguration))]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestContext</span> : <span class="hljs-title">DbContext</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestContext</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> connectionString</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">connectionString</span>)
    </span>{
    }
					<span class="hljs-keyword">public</span> DbSet&lt;TestData&gt; TestData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>

					<h4 id="1-2-6-2-entity-framework-core">1.2.6.2 Entity Framework Core</h4>

					<p>To use the MySQL connector with Entity Framework Core, inject a <code>DbContext</code> into your application with the standard <code>AddDbContext&lt;&gt;()</code> method, substituting Steeltoe’s <code>UseMySql</code> method that takes an <code>IConfiguration</code> as a parameter in the options configuration for the standard <code>UseMySql</code> method. This example demonstrates the basic usage:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.MySql.EFCore;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
        ...
        services.AddDbContext&lt;TestContext&gt;(options =&gt; options.UseMySql(Configuration));
        ...
    }
    ...
</code></pre>

					<p>Your <code>DbContext</code> does not need to be modified from a standard <code>DbContext</code> to work with Steeltoe:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
...

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestContext</span> : <span class="hljs-title">DbContext</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestContext</span>(<span class="hljs-params">DbContextOptions options</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)
    </span>{

    }
					<span class="hljs-keyword">public</span> DbSet&lt;TestData&gt; TestData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

</code></pre>

					<p>If you need to set additional properties for the <code>DbContext</code> like <code>MigrationsAssembly</code> or connection retry settings, create an <code>Action&lt;MySqlDbContextOptionsBuilder&gt;</code> like this:</p>

<pre><code class="csharp hljs">Action&lt;MySqlDbContextOptionsBuilder&gt; mySqlOptionsAction = (o) =&gt;
{
  o.MigrationsAssembly(<span class="hljs-keyword">typeof</span>(Startup).GetTypeInfo().Assembly.GetName().Name);
					<span class="hljs-comment">// Configuring Connection Resiliency: https://docs.microsoft.com/en-us/ef/core/miscellaneous/connection-resiliency</span>
  o.EnableRetryOnFailure(maxRetryCount: <span class="hljs-number">15</span>, maxRetryDelay: TimeSpan.FromSeconds(<span class="hljs-number">30</span>), errorNumbersToAdd: <span class="hljs-literal">null</span>);
};
</code></pre>

					<p>Pass your new options action into the AddDbContext method:</p>

<pre><code class="csharp hljs">services.AddDbContext&lt;TestContext&gt;(options =&gt; options.UseMySql(Configuration, mySqlOptionsAction));
</code></pre>

					<h3 id="1-2-7-use-dbcontext">1.2.7 Use DbContext</h3>

					<p>Once you have configured and added the DbContext to the service container, inject and use it in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Project.Models;
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">MySqlData</span>(<span class="hljs-params">[FromServices] TestContext context</span>)
    </span>{
					<span class="hljs-keyword">return</span> View(context.TestData.ToList());
    }
</code></pre>

					<h1 id="2-0-postgresql">2.0 PostgreSQL</h1>

					<p>This connector simplifies using PostgreSQL in an application running on Cloud Foundry.</p>

					<p>Currently, the connector supports the <a target="_blank" href="https://www.npgsql.org/">Npgsql</a> provider.</p>

					<p>This connector provides a <code>IHealthContributor</code> which you can use in conjunction with the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-3-health">Steeltoe Management Health</a> check endpoint.  See the <a href="#using-health-contributors">Using Health Contributors</a> section for details on how to make use of it.</p>

					<p>You can find the source code for this connector <a target="_blank" href="https://github.com/SteeltoeOSS/Connectors">here</a>.</p>

					<p>You should know how the new .NET <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Configuration service</a> works before starting to use the connector. You need a basic understanding of the <code>ConfigurationBuilder</code> and how to add providers to the builder to configure the connector.</p>

					<p>You should also know how the ASP.NET Core <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup">Startup</a> class is used to configure the application services for the app. Pay particular attention to the <code>ConfigureServices()</code> method.</p>

					<p>To use this connector:</p>

					<ol>
						<li>Create a PostgreSQL Service instance and bind it to your application.</li>
						<li>Optionally, configure any PostgreSQL client settings (such as <code>appsettings.json</code>).</li>
						<li>Add the Steeltoe Cloud Foundry config provider to your <code>ConfigurationBuilder</code>.</li>
						<li>Add <code>NpgsqlConnection</code> or <code>DbContext</code> to your <code>IServiceCollection</code>.</li>
					</ol>

					<h3 id="2-2-1-add-nuget-reference">2.2.1 Add NuGet Reference</h3>

					<p>To use the PostgreSQL connector, add your choice of PostgreSQL package between <a target="_blank" href="https://www.nuget.org/packages/Npgsql/">Npgsql</a> and <a target="_blank" href="https://www.nuget.org/packages/Npgsql.EntityFrameworkCore.PostgreSQL/">Npgsql.EntityFrameworkCore.PostgreSQL</a> as you would if you weren’t using Steeltoe. Then, add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a>.</p>

					<blockquote>
						<p>NOTE: Steeltoe does not currently include direct support for PostgreSQL with Entity Framework 6</p>
					</blockquote>

					<h3 id="2-2-2-configure-settings">2.2.2 Configure Settings</h3>

					<p>The PostgreSQL connector supports several settings for creating the <code>NpgsqlConnection</code> to a database. This can be useful when you develop and test an application locally and need to configure the connector for non-default settings.</p>

					<p>The following example shows a PostgreSQL connector configuration (in JSON) to set up a connection to a database at <code>myserver:5432</code>:</p>

<pre><code class="json hljs">{
  ...
					<span class="hljs-attr">"postgres"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"host"</span>: <span class="hljs-string">"myserver"</span>,
					<span class="hljs-attr">"port"</span>: <span class="hljs-number">5432</span>
    }
  }
  ...
}
</code></pre>

					<p>The following table describes all of the possible settings for the connector:</p>

					<table>
						<thead>
							<tr>
								<th>Key</th>
								<th>Description</th>
								<th>Default</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>server</td>
								<td>Hostname or IP Address of server</td>
								<td>localhost</td>
							</tr>
							<tr>
								<td>port</td>
								<td>Port number of server</td>
								<td>5432</td>
							</tr>
							<tr>
								<td>username</td>
								<td>Username for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>password</td>
								<td>Password for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>database</td>
								<td>Schema to which to connect</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>connectionString</td>
								<td>Full connection string</td>
								<td>built from settings</td>
							</tr>
							<tr>
								<td>urlEncodedCredentials</td>
								<td>Set to <code>true</code> if your service broker provides URL-encoded credentials</td>
								<td>false</td>
							</tr>
						</tbody>
					</table>

					<blockquote>
						<p>IMPORTANT: All of these settings should be prefixed with <code>postgres:client:</code>.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<blockquote>
						<p>NOTE: If a ConnectionString is provided and VCAP_SERVICES are not detected (a typical scenario for local app development), the ConnectionString will be used exactly as provided.</p>
					</blockquote>

					<h3 id="2-2-3-cloud-foundry">2.2.3 Cloud Foundry</h3>

					<p>To use PostgreSQL on Cloud Foundry, after a PostgreSQL service is installed, you can create and bind an instance of it to your application by using the Cloud Foundry CLI, as follows:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Create PostgreSQL service</span>
cf create-service EDB-Shared-PostgreSQL <span class="hljs-string">"Basic PostgreSQL Plan"</span> myPostgres

<span class="hljs-comment"># Bind service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp myPostgres

<span class="hljs-comment"># Restage the app to pick up change</span>
cf restage myApp
</code></pre>

					<blockquote>
						<p>NOTE: The preceding commands work for the PostgreSQL service provided by EDB on Cloud Foundry. For another service, adjust the <code>create-service</code> command to fit your environment.</p>
					</blockquote>

					<p>Version 2.1.1+ of this connector works with the <a target="_blank" href="https://docs.pivotal.io/partners/azure-open-service-broker-pcf/index.html">Azure Open Service Broker for PCF</a>. Be sure to set <code>postgres:client:urlEncodedCredentials</code> to <code>true</code> as this broker may provide credentials that have been URL Encoded.</p>

					<p>Once the service is bound to your application, the connector’s settings are available in <code>VCAP_SERVICES</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="2-2-4-add-npgsqlconnection">2.2.4 Add NpgsqlConnection</h3>

					<p>To use a <code>NpgsqlConnection</code> in your application, add it to the service container in the <code>ConfigureServices()</code> method of the <code>Startup</code> class, as shown in the following example:</p>

<pre><code class="csharp hljs"> <span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.PostgreSql;

					<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
     ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
     </span>{
       ...
     }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
     </span>{
					<span class="hljs-comment">// Add NpgsqlConnection configured from Cloud Foundry</span>
         services.AddPostgresConnection(Configuration);

					<span class="hljs-comment">// Add framework services.</span>
         services.AddMvc();
         ...
     }
     ...
</code></pre>

					<p>The <code>AddPostgresConnection(Configuration)</code> method call configures the <code>NpgsqlConnection</code> by using the configuration built by the application and adds the connection to the service container.</p>

					<h3 id="2-2-5-use-npgsqlconnection">2.2.5 Use NpgsqlConnection</h3>

					<p>Once the connection is configured and added to the service container, you can inject and use in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Npgsql;
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">PostgresData</span>(<span class="hljs-params">[FromServices] NpgsqlConnection dbConnection</span>)
    </span>{
        dbConnection.Open();

        NpgsqlCommand cmd = <span class="hljs-keyword">new</span> NpgsqlCommand(<span class="hljs-string">"SELECT * FROM TestData;"</span>, dbConnection);
					<span class="hljs-keyword">var</span> rdr = cmd.ExecuteReader();

					<span class="hljs-keyword">while</span> (rdr.Read())
        {
            ViewData[<span class="hljs-string">"Key"</span> + rdr[<span class="hljs-number">0</span>]] = rdr[<span class="hljs-number">1</span>];
        }

        rdr.Close();
        dbConnection.Close();

					<span class="hljs-keyword">return</span> View();
    }
}

</code></pre>

					<h3 id="2-2-6-add-dbcontext">2.2.6 Add DbContext</h3>

					<p>To use Entity Framework, inject and use a <code>DbContext</code> in your application instead of a <code>NpgsqlConnection</code> through the <code>AddDbContext&lt;&gt;()</code> method, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.PostgreSql.EFCore;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
					<span class="hljs-comment">// Add EFCore TestContext configured with a PostgreSQL configuration</span>
        services.AddDbContext&lt;TestContext&gt;(options =&gt; options.UseNpgsql(Configuration));

					<span class="hljs-comment">// Add framework services.</span>
        services.AddMvc();
        ...
    }
</code></pre>

					<p>The <code>AddDbContext&lt;TestContext&gt;(options =&gt; options.UseNpgsql(Configuration));</code> method call configures the <code>TestContext</code> by using the configuration built by the application and adds the context to the service container.</p>

					<p>The following example shows how you would define the <code>DbContext</code>:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
...

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestContext</span> : <span class="hljs-title">DbContext</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestContext</span>(<span class="hljs-params">DbContextOptions options</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)
    </span>{
    }
					<span class="hljs-keyword">public</span> DbSet&lt;TestData&gt; TestData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>

					<p>If you need to set additional properties for the <code>DbContext</code> like <code>MigrationsAssembly</code> or connection retry settings, create an <code>Action&lt;NpgsqlDbContextOptionsBuilder&gt;</code> like this:</p>

<pre><code class="csharp hljs">Action&lt;NpgsqlDbContextOptionsBuilder&gt; npgsqlOptionsAction = (o) =&gt;
{
  o.MigrationsAssembly(<span class="hljs-keyword">typeof</span>(Startup).GetTypeInfo().Assembly.GetName().Name);
					<span class="hljs-comment">// Configuring Connection Resiliency: https://docs.microsoft.com/en-us/ef/core/miscellaneous/connection-resiliency</span>
  o.EnableRetryOnFailure(maxRetryCount: <span class="hljs-number">15</span>, maxRetryDelay: TimeSpan.FromSeconds(<span class="hljs-number">30</span>), errorNumbersToAdd: <span class="hljs-literal">null</span>);
};
</code></pre>

					<p>Pass your new options action into the AddDbContext method:</p>

<pre><code class="csharp hljs">services.AddDbContext&lt;TestContext&gt;(options =&gt; options.UseNpgsql(Configuration, npgsqlOptionsAction));
</code></pre>

					<h3 id="2-2-7-use-dbcontext">2.2.7 Use DbContext</h3>

					<p>Once you have configured and added the context to the service container, you can inject and use it in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Project.Models;
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">PostgresData</span>(<span class="hljs-params">[FromServices] TestContext context</span>)
    </span>{
					<span class="hljs-keyword">return</span> View(context.TestData.ToList());
    }
}
</code></pre>

					<h1 id="3-0-microsoft-sql-server">3.0 Microsoft SQL Server</h1>

					<p>This connector simplifies using Microsoft SQL Server in an application running on Cloud Foundry. The connector is built to work with <code>System.Data.SqlClient</code> and provides additional extension methods for using Entity Framework.</p>

					<p>This connector provides a <code>IHealthContributor</code> which you can use in conjunction with the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-3-health">Steeltoe Management Health</a> check endpoint.  See the <a href="#using-health-contributors">Using Health Contributors</a> section for details on how to make use of it.</p>

					<p>The source code for this connector can be found <a target="_blank" href="https://github.com/SteeltoeOSS/Connectors">here</a>.</p>

					<p>You should know how the new .NET <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Configuration service</a> works before starting to use the connector. You need a basic understanding of the <code>ConfigurationBuilder</code> and how to add providers to the builder to configure the connector.</p>

					<p>You should also know how the ASP.NET Core <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup">Startup</a> class is used in configuring the application services. Pay particular attention to the usage of the <code>ConfigureServices()</code> method.</p>

					<p>To use this connector:</p>

					<ol>
						<li>Create a Microsoft SQL Service instance and bind it to your application.</li>
						<li>Optionally, configure any Microsoft SQL Server client settings (such as <code>appsettings.json</code>) you need.</li>
						<li>Add the Steeltoe Cloud Foundry configuration provider to your <code>ConfigurationBuilder</code>.</li>
						<li>Add <code>SqlConnection</code> or <code>DbContext</code> to your <code>IServiceCollection</code>.</li>
					</ol>

					<h3 id="3-2-1-add-nuget-reference">3.2.1 Add NuGet Reference</h3>

					<p>To use the Microsoft SQL Server connector, add your choice of Microsoft SQL Server package between <a target="_blank" href="https://www.nuget.org/packages/System.Data.SqlClient/">System.Data.SqlClient</a>, <a target="_blank" href="https://www.nuget.org/packages/EntityFramework/">Entity Framework</a> and <a target="_blank" href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/">Microsoft.EntityFrameworkCore.SqlServer</a>, as you would if you weren’t using Steeltoe. Then, add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a>.</p>

					<h3 id="3-2-2-configure-settings">3.2.2 Configure Settings</h3>

					<p>The Microsoft SQL Server connector supports several configuration options. These settings can be used to develop or test an application locally and then be overridden during deployment.</p>

					<p>The following Microsoft SQL Server connector configuration shows how to connect to SQL Server 2016 Express LocalDB:</p>

<pre><code class="json hljs">{
  ...
					<span class="hljs-attr">"sqlserver"</span>: {
					<span class="hljs-attr">"credentials"</span>: {
					<span class="hljs-attr">"connectionString"</span>: <span class="hljs-string">"Server=(localdb)\\mssqllocaldb;database=Steeltoe;Trusted_Connection=True;"</span>
    }
  }
  ...
}
</code></pre>

					<p>The following table shows the available settings for the connector:</p>

					<table>
						<thead>
							<tr>
								<th>Key</th>
								<th>Description</th>
								<th>Steeltoe Default</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>server</td>
								<td>Hostname or IP Address of server</td>
								<td>localhost</td>
							</tr>
							<tr>
								<td>port</td>
								<td>Port number of server</td>
								<td>1433</td>
							</tr>
							<tr>
								<td>username</td>
								<td>Username for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>password</td>
								<td>Password for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>database</td>
								<td>Schema to which to connect</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>connectionString</td>
								<td>Full connection string</td>
								<td>built from settings</td>
							</tr>
							<tr>
								<td>integratedSecurity</td>
								<td>Enable Windows Authentication (For local use only)</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>urlEncodedCredentials</td>
								<td>Set to <code>true</code> if your service broker provides URL-encoded credentials</td>
								<td>false</td>
							</tr>
						</tbody>
					</table>

					<blockquote>
						<p>IMPORTANT: All of the settings shown in the preceding table should be prefixed with <code>sqlserver:credentials:</code>.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<blockquote>
						<p>NOTE: If a ConnectionString is provided and VCAP_SERVICES are not detected (a typical scenario for local app development), the ConnectionString will be used exactly as provided.</p>
					</blockquote>

					<h3 id="3-2-3-cloud-foundry">3.2.3 Cloud Foundry</h3>

					<p>To use Microsoft SQL Server on Cloud Foundry, you need a service instance bound to your application. If the <a target="_blank" href="https://github.com/cf-platform-eng/mssql-server-broker">Microsoft SQL Server broker</a> is installed in your Cloud Foundry instance, use it to create a new service instance, as follows:</p>

<pre><code class="bash hljs">cf create-service SqlServer sharedVM mySqlServerService
</code></pre>

					<p>An alternative to the broker is to use a user-provided service to explicitly provide connection information to the application, as shown in the following example:</p>

<pre><code class="bash hljs">cf cups mySqlServerService -p <span class="hljs-string">'{"pw": "|password|","uid": "|user id|","uri": "jdbc:sqlserver://|host|:|port|;databaseName=|database name|"}'</span>
</code></pre>

					<p>Version 2.1.1+ of this connector works with the <a target="_blank" href="https://docs.pivotal.io/partners/azure-open-service-broker-pcf/index.html">Azure Open Service Broker for PCF</a>. Be sure to set <code>sqlServer:client:urlEncodedCredentials</code> to <code>true</code> as this broker may provide credentials that have been URL Encoded.</p>

					<p>If you are creating a service for an application that has already been deployed, you need to bind the service and restart or restage the application with the following commands:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Bind service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp mySqlServerService

<span class="hljs-comment"># Restage the app to pick up change</span>
cf restage myApp
</code></pre>

					<p>If you have not already deployed the application, a reference in the <code>manifest.yml</code> file can take care of the binding for you.</p>

					<blockquote>
						<p>NOTE: The commands shown in the preceding example may not exactly match the service or plan names available in your environment. You may have to adjust the <code>create-service</code> command to fit your environment. Use <code>cf marketplace</code> to see what is available.</p>
					</blockquote>

					<p>Once the service is bound to your application, the connector’s settings are available in <code>VCAP_SERVICES</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="3-2-4-add-sqlconnection">3.2.4 Add SqlConnection</h3>

					<p>To use a <code>SqlConnection</code> in your application, add it to the service container in the <code>ConfigureServices()</code> method of the <code>Startup</code> class, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.SqlServer;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
					<span class="hljs-comment">// Add SqlConnection configured from Configuration</span>
        services.AddSqlServerConnection(Configuration);

					<span class="hljs-comment">// Add framework services.</span>
        services.AddMvc();
        ...
    }
    ...
</code></pre>

					<p>The <code>AddSqlServerConnection(Configuration)</code> method call shown in the previous example configures the <code>SqlConnection</code> by using the configuration built by the application and adds the connection to the service container.</p>

					<h3 id="3-2-5-use-sqlconnection">3.2.5 Use SqlConnection</h3>

					<p>Once you have configured and added the connection to the service container, you can inject it and use it in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> System.Data.SqlClient;
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">SqlData</span>(<span class="hljs-params">[FromServices] SqlConnection dbConnection</span>)
    </span>{
        dbConnection.Open();

        MySqlCommand cmd = <span class="hljs-keyword">new</span> MySqlCommand(<span class="hljs-string">"SELECT * FROM TestData;"</span>, dbConnection);
        MySqlDataReader rdr = cmd.ExecuteReader();

					<span class="hljs-keyword">while</span> (rdr.Read())
        {
            ViewData[<span class="hljs-string">"Key"</span> + rdr[<span class="hljs-number">0</span>]] = rdr[<span class="hljs-number">1</span>];
        }

        rdr.Close();
        dbConnection.Close();

					<span class="hljs-keyword">return</span> View();
    }
}
</code></pre>

					<blockquote>
						<p>NOTE: The preceding code does not create a database or a table or insert data. As written, it fails unless you create the database, table, and data ahead of time.</p>
					</blockquote>

					<h3 id="3-2-6-add-dbcontext">3.2.6 Add DbContext</h3>

					<h4 id="3-2-6-1-entity-framework-6">3.2.6.1 Entity Framework 6</h4>

					<p>To use the Microsoft SQL connector with Entity Framework 6, inject a DbContext into your application using the AddDbContext&lt;&gt;() method (provided by Steeltoe) that takes an IConfiguration as a parameter, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.SqlServer.EF6;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
        ...
        services.AddDbContext&lt;TestContext&gt;(Configuration);
        ...
    }
    ...
</code></pre>

					<p>The <code>AddDbContext&lt;TestContext&gt;(..)</code> method call configures <code>TestContext</code> by using the configuration built earlier and then adds the <code>DbContext</code> (<code>TestContext</code>) to the service container.</p>

					<p>Your <code>DbContext</code> does not need to be modified from a standard EF6 <code>DbContext</code> to work with Steeltoe:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> System.Data.Entity;
...

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestContext</span> : <span class="hljs-title">DbContext</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestContext</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> connectionString</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">connectionString</span>)
    </span>{
    }
					<span class="hljs-keyword">public</span> DbSet&lt;TestData&gt; TestData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>

					<h4 id="3-2-6-2-entity-framework-core">3.2.6.2 Entity Framework Core</h4>

					<p>To use the Microsoft SQL Server connector with Entity Framework Core, inject a <code>DbContext</code> into your application with the standard <code>AddDbContext&lt;&gt;()</code> method, substituting Steeltoe’s <code>UseSqlServer</code> method that takes an <code>IConfiguration</code> as a parameter in the options configuration for the standard <code>UseSqlServer</code> method. This example demonstrates the basic usage:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.SqlServer.EFCore;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
        ...
        services.AddDbContext&lt;TestContext&gt;(options =&gt; options.UseSqlServer(Configuration));
        ...
    }
    ...
</code></pre>

					<p>Your <code>DbContext</code> does not need to be modified from a standard <code>DbContext</code> to work with Steeltoe:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
...

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestContext</span> : <span class="hljs-title">DbContext</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestContext</span>(<span class="hljs-params">DbContextOptions options</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)
    </span>{

    }
					<span class="hljs-keyword">public</span> DbSet&lt;TestData&gt; TestData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

</code></pre>

					<p>If you need to set additional properties for the <code>DbContext</code> like <code>MigrationsAssembly</code> or connection retry settings, create an <code>Action&lt;SqlServerDbContextOptionsBuilder&gt;</code> like this:</p>

<pre><code class="csharp hljs">Action&lt;SqlServerDbContextOptionsBuilder&gt; sqlServerOptionsAction = (o) =&gt;
{
  o.MigrationsAssembly(<span class="hljs-keyword">typeof</span>(Startup).GetTypeInfo().Assembly.GetName().Name);
					<span class="hljs-comment">// Configuring Connection Resiliency: https://docs.microsoft.com/en-us/ef/core/miscellaneous/connection-resiliency</span>
  o.EnableRetryOnFailure(maxRetryCount: <span class="hljs-number">15</span>, maxRetryDelay: TimeSpan.FromSeconds(<span class="hljs-number">30</span>), errorNumbersToAdd: <span class="hljs-literal">null</span>);
};
</code></pre>

					<p>Pass your new options action into the AddDbContext method:</p>

<pre><code class="csharp hljs">services.AddDbContext&lt;TestContext&gt;(options =&gt; options.UseSqlServer(Configuration, sqlServerOptionsAction));
</code></pre>

					<h3 id="3-2-7-use-dbcontext">3.2.7 Use DbContext</h3>

					<p>Once you have configured and added the DbContext to the service container, you can inject it and use it in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Project.Models;
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">SqlData</span>(<span class="hljs-params">[FromServices] TestContext context</span>)
    </span>{
					<span class="hljs-keyword">return</span> View(context.TestData.ToList());
    }
</code></pre>

					<h1 id="4-0-rabbitmq">4.0 RabbitMQ</h1>

					<p>This connector simplifies using the <a target="_blank" href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html">RabbitMQ Client</a> in an application running on Cloud Foundry. We recommend following that tutorial, because you need to know how to use it before proceeding to use the connector.</p>

					<p>This connector provides a <code>IHealthContributor</code> which you can use in conjunction with the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-3-health">Steeltoe Management Health</a> check endpoint.  See the <a href="#using-health-contributors">Using Health Contributors</a> section for details on how to make use of it.</p>

					<p>The source code for this connector can be found <a target="_blank" href="https://github.com/SteeltoeOSS/Connectors">here</a>.</p>

					<p>You should know how the new .NET <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Configuration service</a> works before starting to use the connector. To configure the connector, you need a basic understanding of the <code>ConfigurationBuilder</code> and how to add providers to the builder.</p>

					<p>You should also know how the ASP.NET Core <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup">Startup</a> class is used in configuring the application services for the application. Pay particular attention to the usage of the <code>ConfigureServices()</code> method.</p>

					<p>You probably want some understanding of how to use the <a target="_blank" href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html">RabbitMQ Client</a> before starting to use this connector.</p>

					<p>To use this Connector:</p>

					<ol>
						<li>Create and bind a RabbitMQ service instance to your application.</li>
						<li>Optionally, configure any RabbitMQ client settings (such as in <code>appsettings.json</code>)</li>
						<li>Add the Steeltoe Cloud Foundry config provider to your <code>ConfigurationBuilder</code>.</li>
						<li>Add the RabbitMQ <code>ConnectionFactory</code> to your <code>ServiceCollection</code>.</li>
					</ol>

					<h3 id="4-2-1-add-nuget-reference">4.2.1 Add NuGet Reference</h3>

					<p>To use the RabbitMQ connector, you need to add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a> and <code>RabbitMQ.Client</code>.</p>

					<h3 id="4-2-2-configure-settings">4.2.2 Configure Settings</h3>

					<p>The connector supports several settings for the RabbitMQ ConnectionFactory that can be useful when you are developing and testing an application locally and you need to have the connector configure the connection for non-default settings.</p>

					<p>The following example of the connectors configuration in JSON shows how to setup a connection to a RabbitMQ server at <code>amqp://guest:guest@127.0.0.1/</code>:</p>

<pre><code class="json hljs">{
  ...
					<span class="hljs-attr">"rabbitmq"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"uri"</span>: <span class="hljs-string">"amqp://guest:guest@127.0.0.1/"</span>
    }
  }
  ...
}
</code></pre>

					<p>The following table describes all the possible settings for the connector:</p>

					<table>
						<thead>
							<tr>
								<th>Key</th>
								<th>Description</th>
								<th>Default</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>server</td>
								<td>Hostname or IP Address of the server</td>
								<td>127.0.0.1</td>
							</tr>
							<tr>
								<td>port</td>
								<td>Port number of the server</td>
								<td>5672</td>
							</tr>
							<tr>
								<td>username</td>
								<td>Username for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>password</td>
								<td>Password for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>virtualHost</td>
								<td>Virtual host to which to connect</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>sslEnabled</td>
								<td>Should SSL be enabled</td>
								<td>false</td>
							</tr>
							<tr>
								<td>sslPort</td>
								<td>SSL Port number of server</td>
								<td>5671</td>
							</tr>
							<tr>
								<td>uri</td>
								<td>Full connection string</td>
								<td>built from settings</td>
							</tr>
							<tr>
								<td>urlEncodedCredentials</td>
								<td>Set to <code>true</code> if your service broker provides URL-encoded credentials</td>
								<td>false</td>
							</tr>
						</tbody>
					</table>

					<blockquote>
						<p>IMPORTANT: All of these settings should be prefixed with <code>rabbitmq:client:</code>.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="4-2-3-cloud-foundry">4.2.3 Cloud Foundry</h3>

					<p>To use RabbitMQ on Cloud Foundry, you can create and bind an instance to your application using the Cloud Foundry CLI, as follows:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Create RabbitMQ service</span>
cf create-service p-rabbitmq standard myRabbitMQService

<span class="hljs-comment"># Bind the service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp myRabbitMQService

<span class="hljs-comment"># Restage the app to pick up changes</span>
cf restage myApp
</code></pre>

					<blockquote>
						<p>NOTE: The preceding commands assume you use the RabbitMQ service provided by Pivotal on Cloud Foundry. If you use a different service, adjust the <code>create-service</code> command to fit your environment.</p>
					</blockquote>

					<p>Once the service is bound to your application, the connector’s settings are available in <code>VCAP_SERVICES</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="4-2-4-add-rabbitmq-connectionfactory">4.2.4 Add RabbitMQ ConnectionFactory</h3>

					<p>To use a RabbitMQ <code>ConnectionFactory</code> in your application, add it to the service container in the <code>ConfigureServices()</code> method of the <code>Startup</code> class, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.RabbitMQ;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
					<span class="hljs-comment">// Add RabbitMQ ConnectionFactory configured from Cloud Foundry</span>
        services.AddRabbitMQConnection(Configuration);

					<span class="hljs-comment">// Add framework services.</span>
        services.AddMvc();
        ...
    }
    ...
</code></pre>

					<h3 id="4-2-5-use-rabbitmq-connectionfactory">4.2.5 Use RabbitMQ ConnectionFactory</h3>

					<p>Once you have configured and added the RabbitMQ <code>ConnectionFactory</code> to the service container, you can inject it and use it in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> RabbitMQ.Client;
 ...
					<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
 {
     ...
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">RabbitMQData</span>(<span class="hljs-params">[FromServices] ConnectionFactory factory</span>)
     </span>{

					<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> connection = factory.CreateConnection())
					<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> channel = connection.CreateModel())
         {
             CreateQueue(channel);
					<span class="hljs-keyword">var</span> body = Encoding.UTF8.GetBytes(<span class="hljs-string">"a message"</span>);
             channel.BasicPublish(exchange: <span class="hljs-string">""</span>,
                                  routingKey: <span class="hljs-string">"a-topic"</span>,
                                  basicProperties: <span class="hljs-literal">null</span>,
                                  body: body);

         }
					<span class="hljs-keyword">return</span> View();
     }

 }

</code></pre>

					<h1 id="5-0-redis">5.0 Redis</h1>

					<p>This connector simplifies using a Microsoft <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/performance/caching/distributed#using-a-redis-distributed-cache">RedisCache</a> or a StackExchange <a target="_blank" href="https://stackexchange.github.io/StackExchange.Redis/">IConnectionMultiplexer</a> in an application running on Cloud Foundry.</p>

					<p>In addition to the <a href="#5-1-quick-start">Quick Start</a>, other Steeltoe sample applications are available to help you understand how to use this connector:</p>

					<ul>
						<li><a target="_blank" href="https://github.com/SteeltoeOSS/Samples/tree/dev/Connectors/src/AspDotNet4/Redis4">AspDotNet4/Redis4</a>: Same as the next Quick Start but built for ASP.NET 4.x.</li>
						<li><a target="_blank" href="https://github.com/SteeltoeOSS/Samples/tree/master/Security/src/RedisDataProtectionKeyStore">DataProtection</a>: A sample application showing how to use the Steeltoe DataProtection Key Storage Provider for Redis.</li>
						<li><a target="_blank" href="https://github.com/SteeltoeOSS/Samples/tree/master/MusicStore">MusicStore</a>: A sample application showing how to use all of the Steeltoe components together in an ASP.NET Core application. This is a micro-services based application built from the ASP.NET Core reference app MusicStore provided by Microsoft.</li>
					</ul>

					<p>This connector provides a <code>IHealthContributor</code> which you can use in conjunction with the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-3-health">Steeltoe Management Health</a> check endpoint.  See the <a href="#using-health-contributors">Using Health Contributors</a> section for details on how to make use of it.</p>

					<p>The source code for this connector can be found <a target="_blank" href="https://github.com/SteeltoeOSS/Connectors">here</a>.</p>

					<p>You should know how the .NET <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Configuration service</a> works before starting to use the connector. To configure the connector, you need a basic understanding of the <code>ConfigurationBuilder</code> and how to add providers to the builder.</p>

					<p>You should also know how the ASP.NET Core <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup">Startup</a> class is used in configuring the application services for the app. Pay particular attention to the usage of the <code>ConfigureServices()</code> method.</p>

					<p>You probably want some understanding of how to use the <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/performance/caching/distributed#using-a-redis-distributed-cache">RedisCache</a> or <a target="_blank" href="https://stackexchange.github.io/StackExchange.Redis/">IConnectionMultiplexer</a> before starting to use this connector.</p>

					<p>To use this connector:</p>

					<ol>
						<li>Create a Redis Service instance and bind it to your application.</li>
						<li>Optionally, configure any Redis client settings (for example, in <code>appsettings.json</code>).</li>
						<li>Add the Steeltoe Cloud Foundry config provider to your ConfigurationBuilder.</li>
						<li>Add DistributedRedisCache or ConnectionMultiplexer to your ServiceCollection.</li>
					</ol>

					<h3 id="5-2-1-add-nuget-reference">5.2.1 Add NuGet Reference</h3>

					<p>To use the Redis connector, you need to add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a> and a reference to <code>Microsoft.Extensions.Caching.Redis</code>, <code>StackExchange.Redis</code>, or <code>StackExchange.Redis.StrongName</code>.</p>

					<blockquote>
						<p>NOTE: The requirement to add a direct Redis package reference is new as of version 2.0.0.</p>
					</blockquote>

					<!-- -->

					<blockquote>
						<p>NOTE: Because <code>Microsoft.Extensions.Caching.Redis</code> depends on <code>StackExchange.Redis.StrongName</code>, adding a reference to the Microsoft library also enables access to the StackExchange classes, as seen in the sample application.</p>
					</blockquote>

					<h3 id="5-2-2-configure-settings">5.2.2 Configure Settings</h3>

					<p>The connector supports several settings for the Redis connection that can be useful when you are developing and testing an application locally and you need to have the connector configure the connection for non-default settings.</p>

					<p>The following example of the connector’s configuration in JSON that shows how to set up a connection to a Redis server at <code>https://foo.bar:1111</code>:</p>

<pre><code class="json hljs">{
  ...
					<span class="hljs-attr">"redis"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"host"</span>: <span class="hljs-string">"https://foo.bar"</span>,
					<span class="hljs-attr">"port"</span>: <span class="hljs-number">1111</span>
    }
  }
  ...
}
</code></pre>

					<p>The following table table describes all possible settings for the connector</p>

					<table>
						<thead>
							<tr>
								<th>Key</th>
								<th>Description</th>
								<th>Default</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>host</td>
								<td>Hostname or IP Address of the server</td>
								<td>localhost</td>
							</tr>
							<tr>
								<td>port</td>
								<td>Port number of the server</td>
								<td>6379</td>
							</tr>
							<tr>
								<td>endPoints</td>
								<td>Comma-separated list of host:port pairs</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>clientName</td>
								<td>Identification for the connection within redis</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>connectRetry</td>
								<td>Times to repeat initial connect attempts</td>
								<td>3</td>
							</tr>
							<tr>
								<td>connectTimeout</td>
								<td>Timeout (ms) for connect operations</td>
								<td>5000</td>
							</tr>
							<tr>
								<td>abortOnConnectFail</td>
								<td>Will not create a connection while no servers are available</td>
								<td>true</td>
							</tr>
							<tr>
								<td>keepAlive</td>
								<td>Time (seconds) at which to send a message to help keep sockets alive</td>
								<td>-1</td>
							</tr>
							<tr>
								<td>resolveDns</td>
								<td>Whether DNS resolution should be explicit and eager, rather than implicit</td>
								<td>false</td>
							</tr>
							<tr>
								<td>ssl</td>
								<td>Whether SSL encryption should be used</td>
								<td>false</td>
							</tr>
							<tr>
								<td>sslHost</td>
								<td>Enforces a particular SSL host identity on the server’s certificate</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>writeBuffer</td>
								<td>Size of the output buffer</td>
								<td>4096</td>
							</tr>
							<tr>
								<td>connectionString</td>
								<td>Full connection string</td>
								<td>built from settings</td>
							</tr>
							<tr>
								<td>instanceId</td>
								<td>Cache ID. Used only with <code>IDistributedCache</code></td>
								<td>not set</td>
							</tr>
							<tr>
								<td>urlEncodedCredentials</td>
								<td>Set to <code>true</code> if your service broker provides URL-encoded credentials</td>
								<td>false</td>
							</tr>
						</tbody>
					</table>

					<blockquote>
						<p>IMPORTANT: All of these settings should be prefixed with <code>redis:client:</code>.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<blockquote>
						<p>NOTE: If a ConnectionString is provided and VCAP_SERVICES are not detected (a typical scenario for local app development), the ConnectionString will be used exactly as provided.</p>
					</blockquote>

					<h3 id="5-2-3-cloud-foundry">5.2.3 Cloud Foundry</h3>

					<p>To use Redis on Cloud Foundry, create and bind an instance to your application by using the Cloud Foundry CLI, as shown in the following example:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Create Redis service</span>
cf create-service p-redis shared-vm myRedisCache

<span class="hljs-comment"># Bind service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp myRedisCache

<span class="hljs-comment"># Restage the app to pick up change</span>
cf restage myApp
</code></pre>

					<blockquote>
						<p>NOTE: The preceding commands assume you use the Redis service provided by Pivotal on Cloud Foundry. If you use a different service, you have to adjust the <code>create-service</code> command to fit your environment.</p>
					</blockquote>

					<p>Version 2.1.1+ of this connector works with the <a target="_blank" href="https://docs.pivotal.io/partners/azure-open-service-broker-pcf/index.html">Azure Open Service Broker for PCF</a>. Be sure to set <code>redis:client:urlEncodedCredentials</code> to <code>true</code> as this broker may provide credentials that have been URL Encoded.</p>

					<p>Once the service is bound to your application, the connector’s settings are available in <code>VCAP_SERVICES</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="5-2-4-add-idistributedcache">5.2.4 Add IDistributedCache</h3>

					<p>To use Microsoft’s <code>IDistributedCache</code> in your application, add it to the service container, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.Redis;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params"></span>)
    </span>{
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
					<span class="hljs-comment">// Add Microsoft Redis Cache (IDistributedCache) configured from Cloud Foundry</span>
        services.AddDistributedRedisCache(Configuration);

					<span class="hljs-comment">// Add framework services</span>
        services.AddMvc();
    }
</code></pre>

					<p>The <code>AddDistributedRedisCache(Configuration)</code> method call configures the <code>IDistributedCache</code> by using the configuration built by the application earlier and adds the connection to the service container.</p>

					<h3 id="5-2-5-use-idistributedcache">5.2.5 Use IDistributedCache</h3>

					<p>The following example shows how to inject and use the <code>IDistributedCache</code> in a controller once it has been added to the service container:</p>

<pre><code class="csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.Extensions.Caching.Distributed;
 ...
					<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
 {
					<span class="hljs-keyword">private</span> IDistributedCache _cache;
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HomeController</span>(<span class="hljs-params">IDistributedCache cache</span>)
     </span>{
         _cache = cache;
     }
     ...
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">CacheData</span>(<span class="hljs-params"></span>)
     </span>{
					<span class="hljs-keyword">string</span> key1 = Encoding.Default.GetString(_cache.Get(<span class="hljs-string">"Key1"</span>));
					<span class="hljs-keyword">string</span> key2 = Encoding.Default.GetString(_cache.Get(<span class="hljs-string">"Key2"</span>));

         ViewData[<span class="hljs-string">"Key1"</span>] = key1;
         ViewData[<span class="hljs-string">"Key2"</span>] = key2;

					<span class="hljs-keyword">return</span> View();
     }
 }
</code></pre>

					<h3 id="5-2-6-add-iconnectionmultiplexer">5.2.6 Add IConnectionMultiplexer</h3>

					<p>To use a StackExchange <code>IConnectionMultiplexer</code> in your application directly, add it to the service container in the <code>ConfigureServices()</code> method of the <code>Startup</code> class, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.Redis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{

					<span class="hljs-comment">// Add StackExchange IConnectionMultiplexer configured from Cloud Foundry</span>
        services.AddRedisConnectionMultiplexer(Configuration);

					<span class="hljs-comment">// Add framework services</span>
        services.AddMvc();
        ...
    }
    ...
</code></pre>

					<p>The <code>AddRedisConnectionMultiplexer(Configuration)</code> method call configures the <code>IConnectionMultiplexer</code> by using the configuration built by the application and adds the connection to the service container.</p>

					<blockquote>
						<p>NOTE: If necessary, you can use both <code>IDistributedCache</code> and <code>IConnectionMultiplexer</code> in your application.</p>
					</blockquote>

					<h3 id="5-2-7-use-iconnectionmultiplexer">5.2.7 Use IConnectionMultiplexer</h3>

					<p>Once you have configured and added the <code>IConnectionMultiplexer</code> to the service container, you can inject it and use it in a controller or a view, as shown in the following example:</p>

<pre><code class="csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.Extensions.Caching.Distributed;
 ...
					<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
 {
					<span class="hljs-keyword">private</span> IConnectionMultiplexer _conn;
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HomeController</span>(<span class="hljs-params">IConnectionMultiplexer conn</span>)
     </span>{
         _conn = conn;
     }
     ...
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">ConnData</span>(<span class="hljs-params"></span>)
    </span>{
        IDatabase db = _conn.GetDatabase();

					<span class="hljs-keyword">string</span> key1 = db.StringGet(<span class="hljs-string">"ConnectionMultiplexerKey1"</span>);
					<span class="hljs-keyword">string</span> key2 = db.StringGet(<span class="hljs-string">"ConnectionMultiplexerKey2"</span>);

        ViewData[<span class="hljs-string">"ConnectionMultiplexerKey1"</span>] = key1;
        ViewData[<span class="hljs-string">"ConnectionMultiplexerKey2"</span>] = key2;

					<span class="hljs-keyword">return</span> View();
    }
 }
</code></pre>

					<h1 id="6-0-oauth">6.0 OAuth</h1>

					<p>This connector simplifies using Cloud Foundry OAuth2 security services (for example, <a target="_blank" href="https://github.com/cloudfoundry/uaa">UAA Server</a> or <a target="_blank" href="https://docs.pivotal.io/p-identity/">Pivotal Single Sign-on</a>) by exposing the Cloud Foundry OAuth service configuration data as injectable <code>IOption&lt;OAuthServiceOptions&gt;</code>. It is used by the <a href="https://steeltoe.io/docs/steeltoe-security">Cloud Foundry External Security Providers</a> but can be used separately.</p>

					<p>You should know how the new .NET <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Configuration service</a> works before starting to use the connector. To configure the connector, you need a basic understanding of the <code>ConfigurationBuilder</code> and how to add providers to the builder.</p>

					<p>You should also know how the ASP.NET Core <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup">Startup</a> class is used in configuring the application services for the application. Pay particular attention to the usage of the <code>ConfigureServices()</code> method.</p>

					<p>You probably want some understanding of Cloud Foundry OAuth2 security services (such as <a target="_blank" href="https://github.com/cloudfoundry/uaa">UAA Server</a> or <a target="_blank" href="https://docs.pivotal.io/p-identity/">Pivotal Single Sign-on</a>) before starting to use this connector.</p>

					<p>To use this Connector:</p>

					<ol>
						<li>Create an OAuth service instance and bind it to your application.</li>
						<li>(Optional) Configure any additional settings the OAuth connector needs.</li>
						<li>Add the Steeltoe Cloud Foundry configuration provider to your ConfigurationBuilder.</li>
						<li>Add the OAuth connector to your ServiceCollection.</li>
						<li>Access the OAuth service options.</li>
					</ol>

					<h3 id="6-2-1-add-nuget-reference">6.2.1 Add NuGet Reference</h3>

					<p>To use the OAuth connector, you need to add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a>.</p>

					<h3 id="6-2-2-configure-settings">6.2.2 Configure Settings</h3>

					<p>Configuring additional settings for the connector is not typically required, but, when Cloud Foundry uses self-signed certificates, you might need to disable certificate validation, as shown in the following example:</p>

<pre><code class="json hljs">{
  ...
					<span class="hljs-attr">"security"</span>: {
					<span class="hljs-attr">"oauth2"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"validateCertificates"</span>: <span class="hljs-literal">false</span>
      }
    }
  }
  ...
}
</code></pre>

					<blockquote>
						<p>CAUTION: Self-signed certificates are inherently insecure. Never use them for a production environment.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="6-2-3-cloud-foundry">6.2.3 Cloud Foundry</h3>

					<p>There are multiple ways to set up OAuth services on Cloud Foundry.</p>

					<p>In the <a href="#6-1-quick-start">quick start</a>, we used a user-provided service to define a direct binding to the Cloud Foundry UAA server. Alternatively, you can use the <a target="_blank" href="https://docs.pivotal.io/p-identity/">Pivotal Single Sign-on</a>) product to provision an OAuth service binding. The process to create service binding varies for each of the approaches.</p>

					<p>Regardless of which you choose, once the service is bound to your application, the connector’s settings are available in <code>VCAP_SERVICES</code>. See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<h3 id="6-2-4-add-oauthserviceoptions">6.2.4 Add OAuthServiceOptions</h3>

					<p>Once the OAuth service has been bound to the application, add the OAuth connector to your service collection in the <code>ConfigureServices()</code> method of the <code>Startup</code> class, as shown in the following example:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.OAuth;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span> {
    ...
					<span class="hljs-keyword">public</span> IConfiguration Configuration { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Startup</span>(<span class="hljs-params">...</span>)
    </span>{
      ...
    }
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
    </span>{
					<span class="hljs-comment">// Configure and Add IOptions&lt;OAuthServiceOptions&gt; to the container</span>
        services.AddOAuthServiceOptions(Configuration);

					<span class="hljs-comment">// Add framework services.</span>
        services.AddMvc();
        ...
    }
    ...
</code></pre>

					<p>The <code>AddOAuthServiceOptions(Configuration)</code> method call configures a <code>OAuthServiceOptions</code> instance by using the configuration built by the application and adds it to the service container.</p>

					<h3 id="6-2-5-use-oauthserviceoptions">6.2.5 Use OAuthServiceOptions</h3>

					<p>Finally, you can inject and use the configured <code>OAuthServiceOptions</code> into a controller, as shown in the following example:</p>

<pre><code class="csharp hljs"> <span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.OAuth;
 ...
					<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> : <span class="hljs-title">Controller</span>
 {
     OAuthServiceOptions _options;

					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HomeController</span>(<span class="hljs-params">IOptions&lt;OAuthServiceOptions&gt; oauthOptions</span>)
     </span>{
         _options = oauthOptions.Value;
     }
     ...
					<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OAuthOptions</span>(<span class="hljs-params"></span>)
     </span>{
         ViewData[<span class="hljs-string">"ClientId"</span>] = _options.ClientId;
         ViewData[<span class="hljs-string">"ClientSecret"</span>] = _options.ClientSecret;
         ViewData[<span class="hljs-string">"UserAuthorizationUrl"</span>] = _options.UserAuthorizationUrl;
         ViewData[<span class="hljs-string">"AccessTokenUrl"</span>] = _options.AccessTokenUrl;
         ViewData[<span class="hljs-string">"UserInfoUrl"</span>] = _options.UserInfoUrl;
         ViewData[<span class="hljs-string">"TokenInfoUrl"</span>] = _options.TokenInfoUrl;
         ViewData[<span class="hljs-string">"JwtKeyUrl"</span>] = _options.JwtKeyUrl;
         ViewData[<span class="hljs-string">"ValidateCertificates"</span>] = _options.ValidateCertificates;
         ViewData[<span class="hljs-string">"Scopes"</span>] = CommaDelimit(_options.Scope);

					<span class="hljs-keyword">return</span> View();
     }
 }
</code></pre>

					<h1 id="7-0-mongodb">7.0 MongoDB</h1>

					<p>This connector simplifies using MongoDB in an application running on Cloud Foundry with the <a target="_blank" href="https://docs.mongodb.com/ecosystem/drivers/csharp/">.NET MongoDB Driver</a>.</p>

					<blockquote>
						<p>NOTE: You can see it in action in the Steeltoe fork of <a target="_blank" href="https://github.com/SteeltoeOSS/eShopOnContainers">eShopOnContainers</a>, in the Locations API and the Marketing API.</p>
					</blockquote>

					<p>To use this connector:</p>

					<ol>
						<li>Create a MongoDB service instance and bind it to your application.</li>
						<li>Optionally, configure any MongoDB client settings.</li>
						<li>Add the Steeltoe Cloud Foundry config provider to you <code>ConfigurationBuilder</code>.</li>
						<li>Add MongoDB classes to your DI container.</li>
					</ol>

					<h3 id="7-1-1-add-nuget-reference">7.1.1 Add NuGet Reference</h3>

					<p>To use the MongoDB connector, add the official <a target="_blank" href="https://www.nuget.org/packages/MongoDB.Driver/">MongoDB.Driver NuGet package</a> as you would if you weren’t using Steeltoe. Then, add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a></p>

					<h3 id="7-1-2-configure-settings">7.1.2 Configure Settings</h3>

					<p>The MongoDB connector supports several settings for creating</p>

<pre><code class="json hljs">{
					<span class="hljs-attr">"mongodb"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"server"</span>: <span class="hljs-string">"localhost"</span>,
					<span class="hljs-attr">"port"</span>: <span class="hljs-number">27017</span>,
					<span class="hljs-attr">"options"</span>: {
					<span class="hljs-attr">"replicaSet"</span>: <span class="hljs-string">"rs0"</span>
      }
    }
  }
}
</code></pre>

					<p>The following table table describes all possible settings for the connector</p>

					<table>
						<thead>
							<tr>
								<th>Key</th>
								<th>Description</th>
								<th>Default</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>server</td>
								<td>Hostname or IP Address of the server</td>
								<td>localhost</td>
							</tr>
							<tr>
								<td>port</td>
								<td>Port number of the server</td>
								<td>27017</td>
							</tr>
							<tr>
								<td>username</td>
								<td>Username for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>password</td>
								<td>Password for authentication</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>database</td>
								<td>Name of the database to use</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>options</td>
								<td>any additional <a target="_blank" href="https://mongodb.github.io/mongo-csharp-driver/2.7/apidocs/html/T_MongoDB_Driver_MongoClientSettings.htm">options</a>, passed through as provided</td>
								<td>not set</td>
							</tr>
							<tr>
								<td>connectionString</td>
								<td>Full connection string</td>
								<td>built from settings</td>
							</tr>
							<tr>
								<td>urlEncodedCredentials</td>
								<td>Set to <code>true</code> if your service broker provides URL-encoded credentials</td>
								<td>false</td>
							</tr>
						</tbody>
					</table>

					<blockquote>
						<p>IMPORTANT: All of these settings should be prefixed with <code>mongodb:client:</code>.</p>
					</blockquote>

					<p>The samples and most templates are already set up to read from <code>appsettings.json</code>See <a href="#reading-configuration-values">Reading Configuration Values</a>.</p>

					<blockquote>
						<p>NOTE: If a ConnectionString is provided and VCAP_SERVICES are not detected (a typical scenario for local app development), the ConnectionString will be used exactly as provided.</p>
					</blockquote>

					<h3 id="7-1-3-cloud-foundry">7.1.3 Cloud Foundry</h3>

					<p>To use MongoDB on Cloud Foundry, create and bind an instance to your application by using the Cloud Foundry CLI, as shown in the following example:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Create MongoDB service</span>
cf create-service mongodb-odb standalone_small myMongoDb

<span class="hljs-comment"># Bind service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp myMongoDb

<span class="hljs-comment"># Restage the app to pick up change</span>
cf restage myApp
</code></pre>

					<blockquote>
						<p>NOTE: The preceding commands assume you use the MongoDB Enterprise Service for PCF. If you use a different service, you may have to adjust the <code>create-service</code> command to fit your environment.</p>
					</blockquote>

					<h3 id="7-1-4-add-mongo-client">7.1.4 Add Mongo Client</h3>

					<p>To use <code>MongoClient</code> and <code>MongoUrl</code> in your application, use the extension provided for Microsoft DI:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.Connector.MongoDb;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span>
{
  ...
					<span class="hljs-function"><span class="hljs-keyword">public</span> IServiceProvider <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
  </span>{
      services.AddMongoClient(Configuration);
  }
  ...
}
</code></pre>

					<p>Or the extension provided for Autofac:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">using</span> Steeltoe.CloudFoundry.ConnectorAutofac;
...
  ContainerBuilder container = <span class="hljs-keyword">new</span> ContainerBuilder();
					<span class="hljs-keyword">var</span> regBuilder = container.RegisterMongoDbConnection(configuration);
...
</code></pre>

					<h3 id="7-1-4-use-mongo-client">7.1.4 Use Mongo Client</h3>

					<p>The following example shows how to inject and use an <code>IMongoClient</code> and <code>MongoUrl</code> in order to get an <code>IMongoDatabase</code> to interact with:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SomeClass</span>
{
					<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IMongoDatabase _database = <span class="hljs-literal">null</span>;
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SomeClass</span>(<span class="hljs-params">IMongoClient mongoClient, MongoUrl mongoUrl</span>)
  </span>{
    _database = mongoClient.GetDatabase(mongoUrl.DatabaseName);
  }
					<span class="hljs-keyword">public</span> IMongoCollection&lt;SomeObject&gt; MyObjects
  {
					<span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _database.GetCollection&lt;SomeObject&gt;(<span class="hljs-string">"MyObjects"</span>); }
  }
}
</code></pre>

					<h1 id="8-0-apache-geode-gemfire-pivotal-cloud-cache">8.0 Apache Geode/GemFire/Pivotal Cloud Cache</h1>

				
					<p><a target="_blank" href="https://pivotal.io/pivotal-cloud-cache">Pivotal Cloud Cache</a> is the Cloud Foundry service offering for <a target="_blank" href="https://pivotal.io/pivotal-gemfire">Pivotal GemFire</a>. Pivotal GemFire is Pivotal’s distribution of <a target="_blank" href="https://geode.apache.org/">Apache Geode</a>. This connector was built for using Pivotal Cloud Cache in an application using the <a target="_blank" href="https://gemfire-native.docs.pivotal.io/100/gemfire-native-client/about-client-users-guide.html">GemFire Native Client</a> on Cloud Foundry. It has not been extensively tested under other deployment configurations, but will be best-effort supported for other situations as well.</p>

					<blockquote>
						<p>WARNING: The GemFire Native Client currently only supports 64 bit applications running on Windows. See <a target="_blank" href="https://gemfire-native.docs.pivotal.io/100/gemfire-native-client/system_requirements.html">GemFire Native Client System Requirements</a> for more.</p>
					</blockquote>

					<p>To use this connector:</p>

					<ol>
						<li>Create a Pivotal CloudCache service instance and bind it to your application.</li>
						<li>Optionally, configure GemFire client settings.</li>
						<li>Add the Steeltoe Cloud Foundry config provider to you <code>ConfigurationBuilder</code>.</li>
						<li>Add GemFire classes to your DI container.</li>
					</ol>

					<h3 id="8-1-0-get-gemfire-driver">8.1.0 Get GemFire Driver</h3>

					<p>Follow the instructions in the <a target="_blank" href="https://gemfire-native.docs.pivotal.io/100/gemfire-native-client/install-upgrade-native.html">Pivotal GemFire Native Client documentation</a> for instructions on downloading the driver and getting started with general driver usage.</p>

					<blockquote>
						<p>TIP: Should you wish to avoid committing the driver to source, you are free to copy the <a target="_blank" href="https://github.com/SteeltoeOSS/steeltoe/blob/2.x/src/Connectors/EnableGemFire.ps1">script</a> that Steeltoe’s CI process uses in your own pipelines. You will need a <a target="_blank" href="https://network.pivotal.io/docs/api#how-to-authenticate">legacy API token</a> for the script to complete.</p>
					</blockquote>

					<h3 id="8-1-1-add-nuget-reference">8.1.1 Add NuGet Reference</h3>

					<p>Add a reference to the appropriate <a href="#add-nuget-references">Steeltoe Connector NuGet package</a>.</p>

					<h3 id="8-1-2-configure-settings">8.1.2 Configure Settings</h3>

					<p>
						The GemFire client is highly configurable, beyond the scope of this documentation.
						Steeltoe does not interact with <code>geode.properties</code> or <code>cache.xml</code> files, but any settings found under <code>gemfire:client:properties</code> in your application’s configuration are applied to the <code>CacheFactory</code>.
						Steeltoe attempts to map the properties node in your configuration to a <code>Dictionary&lt;string, string&gt;</code> and then applies each entry to GemFire via the <code>Set</code> method on the CacheFactory.
					</p>

					<p>For example, if you want to set the log-level and connection timeout, use the following in your <code>application.json</code> file:</p>

<pre><code class="json hljs">{
					<span class="hljs-attr">"gemfire"</span>: {
					<span class="hljs-attr">"client"</span>: {
					<span class="hljs-attr">"properties"</span>: {
					<span class="hljs-attr">"log-level"</span>: <span class="hljs-string">"fine"</span>,
					<span class="hljs-attr">"connect-timeout"</span>: <span class="hljs-string">"100ms"</span>
      }
    }
  }
}
</code></pre>

					<p>Refer to the <a target="_blank" href="https://gemfire-native.docs.pivotal.io/100/geode-native-client/configuring/sysprops.html">GemFire documentation</a> for a more complete list of settings to configure.</p>

					<h3 id="8-1-3-cloud-foundry">8.1.3 Cloud Foundry</h3>

					<p>To use Pivotal Cloud Cache on Cloud Foundry:</p>

					<ol>
						<li>Create a service instance</li>
						<li>Bind the instance to your application via either a manifest file or the CLI (shown below)</li>
						<li>Create region (If the application is unable to do so automatically)</li>
					</ol>

<pre><code class="bash hljs"><span class="hljs-comment"># Create CloudCache service instance</span>
cf create-service p-cloudcache dev-plan myPCCService

<span class="hljs-comment"># Bind service to `myApp`</span>
cf <span class="hljs-built_in">bind</span>-service myApp myPCCService

<span class="hljs-comment"># Restage the app to pick up change</span>
cf restage myApp
</code></pre>

					<p>If your application fails to <a target="_blank" href="https://gemfire-native.docs.pivotal.io/100/geode-native-client/regions/regions.html#programmatic-region-creation">programmatically create regions</a>, use the <a target="_blank" href="https://gemfire.docs.pivotal.io/98/gemfire/tools_modules/gfsh/chapter_overview.html">gfsh CLI</a> to create it. You will need the gfsh url and the cluster operator credentials provided in the service binding:</p>

<pre><code class="json hljs"><span class="hljs-string">"p-cloudcache"</span>: [{
    ...
					<span class="hljs-attr">"urls"</span>: {
					<span class="hljs-attr">"gfsh"</span>: <span class="hljs-string">"https://cloudcache-serviceguid.run.pcfone.io/gemfire/v1"</span>,
        ...
      },
					<span class="hljs-attr">"users"</span>: [{
					<span class="hljs-attr">"password"</span>: <span class="hljs-string">"********"</span>,
					<span class="hljs-attr">"roles"</span>: [ <span class="hljs-string">"cluster_operator"</span> ],
					<span class="hljs-attr">"username"</span>: <span class="hljs-string">"********"</span>
        ...
</code></pre>

					<p>Use gfsh to connect to the cluster and create the region:</p>

<pre><code class="bash hljs">gfsh&gt;connect --url=https://cloudcache-someguid.run.pcfone.io/gemfire/v1 --user=cluster_operator_****** --password=******

Successfully connected to: GemFire Manager HTTP service @ https://cloudcache-someguid.run.pcfone.io/gemfire/v1

Cluster-0 gfsh&gt;create region --name=SteeltoeDemo --type=PARTITION
                     Member                      | Status
------------------------------------------------ | ------------------------------------------------------------------------------------
cacheserver-71461c75-ba87-4207-8d6d-c84be814a601 | Region <span class="hljs-string">"/SteeltoeDemo"</span> created on <span class="hljs-string">"cacheserver-71461c75-ba87-4207-8d6d-c84be814a601"</span>
</code></pre>

					<h1 id="common-steps">Common Steps</h1>

					<h2 id="publish-sample">Publish Sample</h2>

					<h3 id="asp-net-core">ASP.NET Core</h3>

					<p>Use the <code>dotnet</code> CLI to <a target="_blank" href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-publish">build and locally publish</a> the application for the framework and runtime you will deploy the application to:</p>

					<ul>
						<li>Linux with .NET Core: <code>dotnet publish -f netcoreapp2.1 -r ubuntu.14.04-x64</code></li>
						<li>Windows with .NET Core: <code>dotnet publish -f netcoreapp2.1 -r win10-x64</code></li>
						<li>Windows with .NET Platform: <code>dotnet publish -f net461 -r win10-x64</code></li>
					</ul>

					<blockquote>
						<p>NOTE: Starting with .NET Core 2.0, the <code>dotnet publish</code> command will automatically restore dependencies for you. Running <code>dotnet restore</code> explicitly is not generally required.</p>
					</blockquote>

					<h3 id="asp-net-4-x">ASP.NET 4.x</h3>

					<ol>
						<li>Open the solution for the sample in Visual Studio</li>
						<li>Right click on the project, select “Publish”</li>
						<li>Use the included <code>FolderProfile</code> to publish to <code>bin/Debug/net461/win10-x64/publish</code></li>
					</ol>

					<h2 id="push-sample">Push Sample</h2>

					<p>Use the Cloud Foundry CLI to push the published application to Cloud Foundry using the parameters that match what you selected for framework and runtime:</p>

<pre><code class="bash hljs"><span class="hljs-comment"># Push to Linux cell</span>
cf push <span class="hljs-_">-f</span> manifest.yml -p bin/Debug/netcoreapp2.1/ubuntu.14.04-x64/publish

<span class="hljs-comment"># Push to Windows cell, .NET Core</span>
cf push <span class="hljs-_">-f</span> manifest-windows.yml -p bin/Debug/netcoreapp2.1/win10-x64/publish

<span class="hljs-comment"># Push to Windows cell, .NET Framework</span>
cf push <span class="hljs-_">-f</span> manifest-windows.yml -p bin/Debug/net461/win10-x64/publish
</code></pre>

					<blockquote>
						<p>NOTE: all sample manifests have been defined to bind their application to their service(s) as created above.</p>
					</blockquote>

					<h2 id="observe-logs">Observe Logs</h2>

					<p>To see the logs as you startup the application, use <code>cf logs oauth</code>.</p>

					<p>On a Linux cell, you should see something resembling the following during startup:</p>

<pre><code class="bash hljs">2016-06-01T09:14:14.38-0600 [CELL/0]     OUT Creating container
2016-06-01T09:14:15.93-0600 [CELL/0]     OUT Successfully created container
2016-06-01T09:14:17.14-0600 [CELL/0]     OUT Starting health monitoring of container
2016-06-01T09:14:21.04-0600 [APP/0]      OUT Hosting environment: Development
2016-06-01T09:14:21.04-0600 [APP/0]      OUT Content root path: /home/vcap/app
2016-06-01T09:14:21.04-0600 [APP/0]      OUT Now listening on: http://*:8080
2016-06-01T09:14:21.04-0600 [APP/0]      OUT Application started. Press Ctrl+C to shut down.
2016-06-01T09:14:21.41-0600 [CELL/0]     OUT Container became healthy
</code></pre>

					<p>On Windows cells, you should see something slightly different but with the same information.</p>

					<h2 id="reading-configuration-values">Reading Configuration Values</h2>

					<p>Once the connector’s settings have been defined, the next step is to read them so that they can be made available to the connector.</p>

					<p>The code in the next example reads connector settings from the <code>appsettings.json</code> file with the .NET JSON configuration provider (<code>AddJsonFile("appsettings.json"))</code> and from <code>VCAP_SERVICES</code> with <code>AddCloudFoundry()</code>. Both sources are then added to the configuration builder. The following code shows how to read from both sources:</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span> {
    ...
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IWebHost <span class="hljs-title">BuildWebHost</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)
    </span>{
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebHostBuilder()
            ...
            .UseCloudFoundryHosting()
            ...
            .ConfigureAppConfiguration((builderContext, configBuilder) =&gt;
            {
					<span class="hljs-keyword">var</span> env = builderContext.HostingEnvironment;
                configBuilder.SetBasePath(env.ContentRootPath)
                    .AddJsonFile(<span class="hljs-string">"appsettings.json"</span>, optional: <span class="hljs-literal">true</span>, reloadOnChange: <span class="hljs-literal">true</span>)
                    .AddJsonFile(<span class="hljs-string">$"appsettings.<span class="hljs-subst">{env.EnvironmentName}</span>.json"</span>, optional: <span class="hljs-literal">true</span>)
                    .AddEnvironmentVariables()
					<span class="hljs-comment">// Add to configuration the Cloudfoundry VCAP settings</span>
                    .AddCloudFoundry();
            })
            .Build();
    }
    ...
</code></pre>

					<p>When pushing the application to Cloud Foundry, the settings from service bindings merge with the settings from other configuration mechanisms (such as <code>appsettings.json</code>).</p>

					<p>If there are merge conflicts, the last provider added to the Configuration takes precedence and overrides all others.</p>

					<p>To manage application settings centrally instead of with individual files, use <a href="https://steeltoe.io/docs/steeltoe-configuration">Steeltoe Configuration</a> and a tool such as <a target="_blank" href="https://github.com/spring-cloud/spring-cloud-config">Spring Cloud Config Server</a></p>

					<blockquote>
						<p>NOTE: If you use the Spring Cloud Config Server, <code>AddConfigServer()</code> automatically calls <code>AddCloudFoundry()</code> for you.</p>
					</blockquote>

					<h2 id="add-nuget-references">Add NuGet References</h2>

					<p>To use Steeltoe Connectors, you need to add a reference to the appropriate NuGet package based on the type of the application you are building and what dependency injector you have chosen, if any. The following table describes the available packages:</p>

					<table>
						<thead>
							<tr>
								<th>App Type</th>
								<th>Package</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Console/ASP.NET 4.x</td>
								<td><code>Steeltoe.CloudFoundry.ConnectorBase</code></td>
								<td>Base functionality. No dependency injection</td>
							</tr>
							<tr>
								<td>ASP.NET 4.x with Autofac</td>
								<td><code>Steeltoe.CloudFoundry.ConnectorAutofac</code></td>
								<td>Includes base. Adds Autofac dependency injection</td>
							</tr>
							<tr>
								<td>ASP.NET Core</td>
								<td><code>Steeltoe.CloudFoundry.ConnectorCore</code></td>
								<td>Includes base. Adds Microsoft Dependency Injection</td>
							</tr>
							<tr>
								<td>ASP.NET Core</td>
								<td><code>Steeltoe.CloudFoundry.Connector.EF6Core</code></td>
								<td>Includes base. Adds Entity Framework 6 with Microsoft Dependency Injection</td>
							</tr>
							<tr>
								<td>ASP.NET Core</td>
								<td><code>Steeltoe.CloudFoundry.Connector.EFCore</code></td>
								<td>Includes base. Adds Entity Framework Core with Microsoft Dependency Injection</td>
							</tr>
						</tbody>
					</table>

					<p>To add any NuGet package, use the package manager tools or (with .NET Core applications only) directly add the appropriate package to your project by using the a <code>PackageReference</code>, as shown in the following listing:</p>

<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
...
					<span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"Steeltoe.CloudFoundry.ConnectorBase"</span> <span class="hljs-attr">Version</span>= <span class="hljs-string">"2.3.0"</span>/&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
</code></pre>

					<h2 id="using-health-contributors">Using Health Contributors</h2>

					<p>At present, Steeltoe provides the following <code>IHealthContributor</code> implementations you can choose from:</p>

					<table>
						<thead>
							<tr>
								<th>Name</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><a target="_blank" href="https://github.com/SteeltoeOSS/Connectors/blob/master/src/Steeltoe.CloudFoundry.ConnectorBase/Queue/RabbitMQHealthContributor.cs">RabbitMQHealthContributor</a></td>
								<td>checks RabbitMQ connection health</td>
							</tr>
							<tr>
								<td><a target="_blank" href="https://github.com/SteeltoeOSS/Connectors/blob/master/src/Steeltoe.CloudFoundry.ConnectorBase/Cache/RedisHealthContributor.cs">RedisHealthContributor</a></td>
								<td>checks Redis cache connection health</td>
							</tr>
							<tr>
								<td><a target="_blank" href="https://github.com/SteeltoeOSS/Connectors/blob/master/src/Steeltoe.CloudFoundry.ConnectorBase/Relational/RelationalHealthContributor.cs">RelationalHealthContributor</a></td>
								<td>checks relational database connection health (MySql, Postgres, SqlServer)</td>
							</tr>
						</tbody>
					</table>

					<p>Each of these contributors are located in the <code>Steeltoe.CloudFoundry.ConnectorBase</code> package and are made available to your application when you reference the connector package.</p>

					<p>If you want to use any one of the <code>IHealthContributor</code>s above in an ASP.NET Core application, simply make use of the corresponding connector as you would normally. By doing so, the contributor is automatically added to the service container for you and is automatically discovered and used by the Health endpoint.</p>

					<p>If you want to make use of any of the contributors in an ASP.NET 4.x application, where no service container exists, you must construct an instance of it using a factory method contained in the contributor and then provide it to the Health endpoint.</p>

					<p>For example, to create an instance of a MySql health contributor you can use the <code>GetMySqlContributor()</code> method in the <code>RelationalHealthContributor</code> as shown below and supply it to the endpoint actuator.</p>

<pre><code class="csharp hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ManagementConfig</span>
{
					<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureManagementActuators</span>(<span class="hljs-params">IConfiguration configuration, ILoggerFactory loggerFactory = <span class="hljs-literal">null</span></span>)
    </span>{
        ...
        ActuatorConfigurator.UseHealthActuator(
            configuration,
					<span class="hljs-keyword">new</span> DefaultHealthAggregator(),
            GetHealthContributors(configuration),
            loggerFactory);
        ...

    }

					<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> IEnumerable&lt;IHealthContributor&gt; <span class="hljs-title">GetHealthContributors</span>(<span class="hljs-params">IConfiguration configuration</span>)
    </span>{
					<span class="hljs-keyword">var</span> healthContributors = <span class="hljs-keyword">new</span> List&lt;IHealthContributor&gt;
        {
					<span class="hljs-keyword">new</span> DiskSpaceContributor(),
            RelationalHealthContributor.GetMySqlContributor(configuration)
        };

					<span class="hljs-keyword">return</span> healthContributors;
    }
</code></pre>

					<h2 id="using-asp-net-core-health-checks">Using ASP.NET Core Health Checks</h2>

					<p>ASP.NET Core also offers <a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/health-checks?view=aspnetcore-2.">Middleware and libraries</a> and abstractions for reporting health. There is wide community support for these abstractions from libraries such as <a target="_blank" href="https://github.com/Xabaril/AspNetCore.Diagnostics.HealthChecks">AspNetCore.Diagnostics.HealthChecks</a>. It is now possible to use these community provided health checks and make them available via the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-5-health">Steeltoe management health endpoint</a>(for integration with PCF or any other infrastructure that depends on this format). In addition, Steeltoe connectors now exposes functionality to easily get connection information which is needed to setup these community health checks.</p>

					<p>For example, to use the Steeltoe MySql connector but instead use ASP.NET Core community health checks, make these changes to Startup.cs:</p>

<pre><code class="csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
</span>{
					<span class="hljs-comment">// Get connection information from Steeltoe helper</span>
					<span class="hljs-keyword">var</span> cm = <span class="hljs-keyword">new</span> ConnectionStringManager(Configuration);
					<span class="hljs-keyword">var</span> connectionString = cm.Get&lt;MySqlConnectionInfo&gt;().ConnectionString;

					<span class="hljs-comment">// Add microsoft community health checks from xabaril</span>
    services.AddHealthChecks().AddMySql(connectionString);  

					<span class="hljs-comment">// Add in a MySql connection (this method also adds an IHealthContributor for it)</span>
    services.AddMySqlConnection(Configuration); <span class="hljs-comment">// will now use community health check instead of Steeltoe health check</span>

					<span class="hljs-comment">// Add  Steeltoe Management endpoint services</span>
    services.AddCloudFoundryActuators(Configuration);

    services.AddHealthChecksUI(); <span class="hljs-comment">// Optionally use the health checks UI</span>

					<span class="hljs-comment">// Add framework services.</span>
    services.AddMvc();
}
</code></pre>

					<blockquote>
						<p>NOTE: AddMySqlConnection will default to the ASP.NET Core health check if found in the service container. This behavior can be toggled off by passing AddMySqlConnection(Configuration, addSteeltoeHealthChecks: true) which will add both health checks. Be warned that this will make the Health check endpoint slower by calling multiple health checks for the same service.</p>
					</blockquote>

<pre><code class="csharp hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory</span>)
</span>{
  ...

					<span class="hljs-comment">// Optionally use ASP.NET Core health middleware for community health checks at /Health</span>
  app.UseHealthChecks(<span class="hljs-string">"/Health"</span>, <span class="hljs-keyword">new</span> HealthCheckOptions()
  {
      Predicate = _ =&gt; <span class="hljs-literal">true</span>,
      ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse
  });

					<span class="hljs-comment">// Optionally use health checks ui at /healthchecks-ui</span>
  app.UseHealthChecksUI();

					<span class="hljs-comment">// Add management endpoints into pipeline</span>
					<span class="hljs-comment">// Steeltoe health check shows up at /cloudfoundryapplication/health</span>
  app.UseCloudFoundryActuators();
  ...
</code></pre>

					<p>A complete example is available <a target="_blank" href="https://github.com/SteeltoeOSS/Samples/tree/2.x/Management/src/AspDotNetCore/MicrosoftHealthChecks">here</a>.</p>
				</div>
			</div>
		</div>
	</div>
	<script src="/javascripts/vendor/gumshoe.js"></script>
	<script src="/javascripts/vendor/highlight.min.js"></script>
	<script src="/javascripts/vendor/jquery-3.1.1.slim.min.js"></script>
	<script src="/javascripts/vendor/particles.min.js"></script>
	<script src="/javascripts/vendor/smooth-scroll.js"></script>
	<script src="/javascripts/vendor/sticky-kit.min.js"></script>
	<script src="/javascripts/vendor/svg-injector.min.js"></script>
	<script src="/javascripts/vendor/tocbot.min.js"></script>
	<script src="/javascripts/all.js"></script>
	<script src="/javascripts/docs.js"></script>
	<script>
		function viewV1() {
			window.location.href = '/1x/steeltoe-configuration/';
		}
				//document.getElementById('docselector').style.display = "inline";
	</script>


</body>
</html>