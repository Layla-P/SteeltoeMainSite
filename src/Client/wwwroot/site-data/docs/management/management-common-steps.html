<h2 id="http-access-asp.net-core">HTTP Access ASP.NET Core</h2>
<p>To expose any of the management endpoints over HTTP in an ASP.NET Core application:</p>
<ol>
<li>Add a reference to <code>Steeltoe.Management.EndpointCore</code> or <code>Steeltoe.Management.CloudFoundryCore</code>.</li>
<li>Configure endpoint settings, as needed (for example, <code>appsettings.json</code>).</li>
<li>Add any additional &quot;contributors&quot; to the service container. (for example, <code>AddSingleton&lt;IHealthContributor, CustomHealthContributor&gt;()</code>)</li>
<li><code>Add</code> the actuator endpoint to the service container (for example, <code>AddHealthActuator()</code>).</li>
<li><code>Use</code> the actuator middleware to provide HTTP access (for example, <code>UseInfoActuator()</code>).</li>
</ol>
<blockquote class="blockquote">
<p>NOTE: Each endpoint uses the same host and port as the application. The default path to each endpoint is specified in its section on this page, along with specific <code>Add</code> and <code>Use</code> method names.</p>
</blockquote>
<p>Starting in Steeltoe version 2.4.0, extensions for both <code>IHostBuilder</code> and <code>IWebHostBuilder</code> are included to configure actuators with a single line of code in <code>program.cs</code>:</p>
<pre><code class="language-csharp">    public static void Main(string[] args)
    {
        BuildWebHost(args).Run();
    }
    public static IHost BuildHost(string[] args) =&gt;
        Host.CreateDefaultBuilder(args)
            .AddCloudFoundryActuators()
            .AddRefreshActuator()
            .Build();
</code></pre>
<blockquote class="blockquote">
<p>NOTE: <code>AddCloudFoundryActuators()</code> and <code>AddLoggingActuator()</code> will automatically configure the DynamicConsoleLogger. If you wish to use the dynamic Serilog console logger, be sure to do so before adding actuators.</p>
</blockquote>
<p>If you prefer to configure the actuators in <code>Startup.cs</code>, extensions are provided for <code>IServiceCollection</code> and <code>IApplicationBuilder</code> to configure and activate the actuator middlewares. If you wish to use all of the Steeltoe endpoints which integrate with the Pivotal Apps Manager, use <code>AddCloudFoundryActuators()</code> and <code>UseCloudFoundryActuators()</code> to add them all at once instead of including each individually, as shown in the following example:</p>
<pre><code class="language-csharp">public class Startup
{
    public IConfiguration Configuration { get; }
    public Startup(IConfiguration configuration)
    {
        Configuration = configuration;
    }
    public void ConfigureServices(IServiceCollection services)
    {
        ...
        // Add management endpoint services like this
        services.AddCloudFoundryActuators(Configuration);
        services.AddRefreshActuator(Configuration);
        ...
    }
    public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
    {
        ...
        // Add management endpoints into pipeline like this
        app.UseCloudFoundryActuators();
        app.UseRefreshActuator();

        // Add ASP.NET Core MVC middleware to pipeline
        app.UseMvc();
        ...
    }
}
</code></pre>
<blockquote class="blockquote">
<p>NOTE: The order in which you add middleware to the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/?view=aspnetcore-2.1&amp;tabs=aspnetcore2x">ASP.NET Core pipeline</a> is important. We recommend that you add the Steeltoe management endpoints before others to ensure proper operation.</p>
</blockquote>
<h2 id="http-access-asp.net-4.x">HTTP Access ASP.NET 4.x</h2>
<p>To expose any of the management endpoints over HTTP in an ASP.NET 4.x application:</p>
<ol>
<li>Add a reference to <code>Steeltoe.Management.EndpointWeb</code>.</li>
<li>Configure endpoint settings, as needed (for example, <code>appsettings.json</code>).</li>
<li><code>Use</code> the middleware to provide HTTP access (for example, <code>UseInfoActuator()</code>).</li>
<li>If using Metrics, start/stop Diagnostics and MetricsExporting (for example, <code>DiagnosticsManager.Instance.Start()</code>)</li>
<li>Update web.config to allow extensionless requests to reach the actuators</li>
</ol>
<pre><code class="language-xml">&lt;system.webServer&gt;
    &lt;handlers&gt;
        &lt;!--  This example is overly broad, it does not need to be used exactly as-is  --&gt;
        &lt;!-- Allow at least GET, POST and OPTIONS requests to go past IIS to actuators --&gt;
        &lt;add name=&quot;ExtensionlessUrlHandler-Integrated-4.0&quot;
                path=&quot;*.&quot;
                verb=&quot;*&quot;
                type=&quot;System.Web.Handlers.TransferRequestHandler&quot;
                preCondition=&quot;integratedMode,runtimeVersionv4.0&quot; /&gt;
    &lt;/handlers&gt;
&lt;/system.webServer&gt;
</code></pre>
<blockquote class="blockquote">
<p>NOTE: Each endpoint uses the same host and port as the application. The default path to each endpoint is specified in its section on this page, along with specific <code>Use</code> method name.</p>
</blockquote>
<p>If you wish to use all of the Steeltoe endpoints which integrate with the Pivotal Apps Manager, call <code>UseCloudFoundryActuators()</code> to configure them all at once instead of including each individually, as shown in the following example:</p>
<pre><code class="language-csharp">public class ManagementConfig
{
    public static IMetricsExporter MetricsExporter { get; set; }

    public static void ConfigureActuators(
        IConfiguration config,
        ILoggerProvider logger,
        IEnumerable&lt;IHealthContributor&gt; contrib,
        IApiExplorer api,
        ILoggerFactory factory = null)
    {
        ActuatorConfigurator.UseCloudFoundryActuators(config, logger, contrib, api, factory);
    }

    public static void Start()
    {
        DiagnosticsManager.Instance.Start();
        if (MetricsExporter != null)
        {
            MetricsExporter.Start();
        }
    }

    public static void Stop()
    {
        DiagnosticsManager.Instance.Stop();
        if (MetricsExporter != null)
        {
            MetricsExporter.Stop();
        }
    }
}
</code></pre>
<p>The above static methods should be called in <code>Global.asax.cs</code>.  In the <code>Application_Start()</code> method call <code>ConfigureActuators()</code>and <code>Start()</code> and in <code>Application_Stop()</code> call <code>Stop()</code>.  See the <a href="https://github.com/SteeltoeOSS/Samples/tree/dev/Management/src/AspDotNet4">Steeltoe Samples repository</a> for more details.</p>
<h2 id="http-access-asp.net-owin">HTTP Access ASP.NET OWIN</h2>
<p>To expose any of the management endpoints over HTTP in an ASP.NET 4.x application:</p>
<ol>
<li>Add a reference to <code>Steeltoe.Management.EndpointOwin</code>.</li>
<li>Configure endpoint settings, as needed (for example, <code>appsettings.json</code>).</li>
<li><code>Use</code> the middleware to provide HTTP access (for example, <code>UseInfoActuator()</code>).</li>
<li>If using Metrics, start/stop Diagnostics and MetricsExporting (for example, <code>DiagnosticsManager.Instance.Start()</code>)</li>
<li>If not self-hosting, add/update web.config entries to ensure OWIN startup and allow requests to reach the actuators</li>
</ol>
<pre><code class="language-xml">    &lt;appSettings&gt;
        &lt;add key=&quot;owin:AutomaticAppStartup&quot; value=&quot;true&quot; /&gt;
    &lt;/appSettings&gt;
    &lt;system.webServer&gt;
        &lt;handlers&gt;
            &lt;!-- Allow GET, POST and OPTIONS requests to go past IIS to actuators --&gt;
            &lt;!-- Adjust the path value if you are not using Pivotal Apps Manager --&gt;
            &lt;add name=&quot;ApiURIs-ISAPI-Integrated-4.0&quot;
                    path=&quot;cloudfoundryapplication/*&quot;
                    verb=&quot;GET,POST,OPTIONS&quot;
                    type=&quot;System.Web.Handlers.TransferRequestHandler&quot;
                    preCondition=&quot;integratedMode,runtimeVersionv4.0&quot; /&gt;
        &lt;/handlers&gt;
    &lt;/system.webServer&gt;
</code></pre>
<blockquote class="blockquote">
<p>NOTE: Each endpoint uses the same host and port as the application. The default path to each endpoint is specified in its section on this page, along with specific <code>Use</code> method name.</p>
</blockquote>
<p>If you wish to use all of the Steeltoe endpoints which integrate with the Pivotal Apps Manager, use <code>UseCloudFoundryActuators()</code> to configure them all at once instead of including each individually, as shown in the following example:</p>
<pre><code class="language-csharp">public class Startup
{
    private IMetricsExporter MetricsExporter { get; set; }

    public void Configuration(IAppBuilder app)
    {
        var config = GlobalConfiguration.Configuration;

        app.UseCloudFoundryActuators(
            ApplicationConfig.Configuration,
            GetHealthContributors(ApplicationConfig.Configuration),
            config.Services.GetApiExplorer(),
            LoggingConfig.LoggerProvider,
            LoggingConfig.LoggerFactory);

        Start();
    }

    private void Start()
    {
        DiagnosticsManager.Instance.Start();
        if (MetricsExporter != null)
        {
            MetricsExporter.Start();
        }
    }

    public void Stop()
    {
        DiagnosticsManager.Instance.Stop();
        if (MetricsExporter != null)
        {
            MetricsExporter.Stop();
        }
    }
}
</code></pre>
