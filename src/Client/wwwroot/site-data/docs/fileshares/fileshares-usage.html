<h2 id="usage">Usage</h2>
<p>Before starting with Steeltoe's Windows Network File Share library, you should already have a plan for interacting with the file system. Steeltoe will only be managing the connection to the file share.</p>
<h3 id="add-nuget-references">Add NuGet References</h3>
<p>Use the NuGet Package Manager or a <code>PackageReference</code> to add a reference to <code>Steeltoe.Common.Net</code></p>
<h3 id="managing-the-connection">Managing the Connection</h3>
<p>The state of the connection to the file share is managed through the lifecycle of <code>WindowsNetworkFileShare</code>. In order to open the connection, instantiate a <code>WindowsFileShare</code>:</p>
<pre><code class="language-csharp">var fileShare = new WindowsNetworkFileShare(@&quot;\\server\path&quot;, new System.Net.NetworkCredential(&quot;username&quot;, &quot;password&quot;));
</code></pre>
<p>The constructor opens the connection with the equivalent of the <code>net use</code> command by calling <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winnetwk/nf-winnetwk-wnetaddconnection2a">WNetAddConnection2</a> with the information provided in the constructor.</p>
<p>In order to close the connection, call dispose on the <code>WindowsNetworkFileShare</code>.</p>
<pre><code class="language-csharp">fileShare.Dispose();
</code></pre>
<p>Because <code>WindowsNetworkFileShare</code> implements <code>IDisposable</code>, you also have the ability to manage the <code>WindowsNetworkFileShare</code> with a using statement:</p>
<pre><code class="language-csharp">using (new WindowsNetworkFileShare(@&quot;\\server\path&quot;, new System.Net.NetworkCredential(&quot;username&quot;, &quot;password&quot;)))
{
    // Interact with an attached network share here
}
</code></pre>
<blockquote class="blockquote">
<p>WARNING: Levels of support for accessing SMB shares on Pivotal Application Service for Windows (PASW) may vary by installed version. Support for IP-based SMB shares was included with the initial 2.4 release and in patch releases for lower versions. Support for FQDN-based SMB shares will be included in PASW 2.5 and in patch releases for lower versions. See the <a href="https://docs.pivotal.io/pivotalcf/2-4/pcf-release-notes/windows-rn.html">PASW Release notes</a> to confirm the relevant patch version required.</p>
</blockquote>
<h3 id="managing-credentials">Managing Credentials</h3>
<p>Credentials are generally required for interacting with SMB shares. <code>WindowsNetworkFileShare</code> does not have an opinion on where those credentials are stored, but as a general guideline, storing credentials with your application's code or standard configuration is not recommended. Consider using the <a href="https://docs.pivotal.io/credhub-service-broker/">CredHub Service Broker</a> for storing and retrieving your credentials.</p>
<p>When used in conjuction with the <a href="../steeltoe-configuration/#1-0-cloud-foundry-provider">Cloud Foundry Configuration Provider</a>, you can access the values in a relatively straightforward way:</p>
<pre><code class="language-csharp">public SomeClassConstructor(IOptions&lt;CloudFoundryServicesOptions&gt; serviceOptions)
{
    var userName = serviceOptions.Services[&quot;credhub&quot;]
       .First(q =&gt; q.Name.Equals(&quot;my-network-share&quot;))
       .Credentials[&quot;share-username&quot;].Value;
    var password = serviceOptions.Services[&quot;credhub&quot;]
       .First(q =&gt; q.Name.Equals(&quot;my-network-share&quot;))
       .Credentials[&quot;share-password&quot;].Value;

    // create credential object to pass to WindowsNetworkFileShare
    var _shareCredential = new NetworkCredential(userName, password);
}
</code></pre>
